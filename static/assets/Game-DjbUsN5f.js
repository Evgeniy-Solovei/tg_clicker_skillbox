import{j as n,w as T,r as l,u as b,b as V,e as C,f as P,i as z}from"./index-BIwUCy7Q.js";import{l as A}from"./logo-exXQDy5k.js";import{a as E,b as D,i as K,q as k}from"./coin-2FF1BFL9.js";import{u as B}from"./useMutation-DYFrq3Rx.js";import{g as U}from"./getCurrTicket-unHkMUTY.js";const Q="_falling_letters_container_11klv_1",W="_img_open_box_11klv_21",J="_logo_11klv_37",N={falling_letters_container:Q,img_open_box:W,logo:J},Z=({x:t,duration:e,id:a,onClick:o})=>n.jsxs("button",{className:"btn",onTouchStart:()=>o(a),id:a,style:{left:`${t}%`,animationDuration:`${e}s`},children:[" ",n.jsx("img",{src:T,className:"falling_letter_white"})]}),d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));function X(t,e=0){return(d[t[e+0]]+d[t[e+1]]+d[t[e+2]]+d[t[e+3]]+"-"+d[t[e+4]]+d[t[e+5]]+"-"+d[t[e+6]]+d[t[e+7]]+"-"+d[t[e+8]]+d[t[e+9]]+"-"+d[t[e+10]]+d[t[e+11]]+d[t[e+12]]+d[t[e+13]]+d[t[e+14]]+d[t[e+15]]).toLowerCase()}let F;const Y=new Uint8Array(16);function tt(){if(!F){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");F=crypto.getRandomValues.bind(crypto)}return F(Y)}const et=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),M={randomUUID:et};function g(t,e,a){if(M.randomUUID&&!e&&!t)return M.randomUUID();t=t||{};const o=t.random||(t.rng||tt)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,X(o)}const nt="_timer_container_1vdlq_1",at="_time_1vdlq_1",w={timer_container:nt,time:at},ot=t=>{const e=Math.floor(t%3600/60),a=t%60;return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};function st({setIsVision:t,time:e,setTimer:a}){return l.useEffect(()=>{const o=setInterval(()=>{a(u=>u>0?u-1:(clearInterval(o),0))},1e3);return()=>clearInterval(o)},[a]),l.useEffect(()=>{e===0&&t(!1)},[e]),n.jsx("div",{className:w.timer_container,children:n.jsx("div",{className:w.time,children:ot(e)})})}const it="/assets/S-blue-Dh_q71fZ.png",ct=[{id:g(),duration:3,x:38},{id:g(),duration:1,x:58}],rt=({setCount:t,blueLetter:e,setBlueLetter:a})=>{const{tg:o}=b(),u=l.useRef([]),[m,h]=l.useState(0),r=s=>{a(c=>c.filter(i=>i.id!==s)),t(c=>c-3),o.HapticFeedback.impactOccurred("light")};return l.useEffect(()=>{const s=setInterval(()=>{if(m<5){const c=ct.map(i=>({...i,id:g(),duration:Math.random()+2}));a(i=>[...i,...c]),h(i=>i+1)}},2e3);return()=>clearInterval(s)},[m]),l.useEffect(()=>{const c=setInterval(()=>{u.current.forEach(i=>{i&&i.getBoundingClientRect().bottom>=window.innerHeight&&(t(p=>p+3),a(p=>p.filter(j=>j.id!==i.id)))})},10);return()=>clearInterval(c)},[e,t,a]),n.jsx(n.Fragment,{children:e.map((s,c)=>n.jsxs("button",{className:"btn_blue",onTouchStart:()=>r(s.id),id:s.id,ref:i=>u.current[c]=i,style:{left:`${s.x}%`,animationDuration:`${s.duration}s`},children:[" ",n.jsx("img",{className:"falling_letter_blue",src:it})]},s.id))})},lt="_counter_container_47eta_1",ut="_counter_47eta_1",$={counter_container:lt,counter:ut};function dt({count:t}){return n.jsx("div",{className:$.counter_container,children:n.jsx("div",{className:$.counter,children:t})})}const mt="/assets/bomb-DeoDqckm.png";function L(){return Math.floor(Math.random()*81)+10}function _t({setCount:t,setWhiteLetter:e,setBlueLetter:a,setFlask:o}){const[u,m]=l.useState([]),{tg:h}=b(),r=s=>{m(c=>c.filter(i=>i.id!==s)),e([]),a([]),o([]),t(c=>c-10),h.HapticFeedback.impactOccurred("heavy")};return l.useEffect(()=>{const c=setInterval(()=>{const i={x:L(),duration:Math.random()+2,id:g().toString()};m(f=>[...f,i])},4e3);return()=>clearInterval(c)},[]),n.jsx(n.Fragment,{children:u.map(s=>n.jsxs("button",{className:"btn_bomb",onTouchStart:()=>r(s.id),id:s.id,style:{left:`${s.x}%`,animationDuration:`${s.duration}s`},children:[" ",n.jsx("img",{src:mt,className:"falling_bomb"})]},s.id))})}const gt="/assets/flask-0VLBKfJP.png";function ht({setCount:t,flasks:e,setFlask:a}){const{tg:o}=b(),u=r=>{a(s=>s.filter(c=>c.id!==r)),t(s=>s+5),o.HapticFeedback.impactOccurred("light")},[m,h]=l.useState(0);return l.useEffect(()=>{const s=setInterval(()=>{if(m<3){const c={x:L(),duration:Math.random()+2,id:g().toString()};a(i=>[...i,c]),h(i=>i+1)}},4200);return()=>clearInterval(s)},[m]),n.jsx(n.Fragment,{children:e.map(r=>n.jsxs("button",{className:"btn_flask",onTouchStart:()=>u(r.id),id:r.id,style:{left:`${r.x}%`,animationDuration:`${r.duration}s`},children:[" ",n.jsx("img",{src:gt,className:"falling_flask"})]},r.id))})}const xt=[{id:g(),duration:Math.random()*3+2,x:5},{id:g(),duration:Math.random()*3+2,x:25},{id:g(),duration:Math.random()*3+2,x:45},{id:g(),duration:Math.random()*3+2,x:65},{id:g(),duration:Math.random()*3+2,x:82}],ft="_modal_vdn92_1",pt="_overlay_vdn92_17",vt="_content_vdn92_23",I={modal:ft,overlay:pt,content:vt};function bt({children:t}){return n.jsx("div",{className:I.modal,children:n.jsx("div",{className:I.overlay,children:n.jsx("div",{className:I.content,children:t})})})}const jt="_container_1mifm_1",kt="_container_content_1mifm_19",yt="_title_game_prize_1mifm_47",St="_coin_box_1mifm_67",Nt="_text_coin_1mifm_83",Ft="_back_home_button_1mifm_107",x={container:jt,container_content:kt,title_game_prize:yt,coin_box:St,text_coin:Nt,back_home_button:Ft};function It({tg_id:t,points:e}){return E.post(`${D}/api/game-result/`,{points:e,tg_id:t}).then(a=>a.data).catch(a=>{console.log(a)})}function Mt({tg_id:t,premium_tickets:e,tickets:a}){return E.post(`${D}/api/game-start/`,{tg_id:t,tickets:a,premium_tickets:e}).then(o=>o.data).catch(o=>{console.log(o)})}function wt({finalPoints:t}){const e=V(),{tg:a,tg_id:o}=b(),u=C(U),m=B({mutationFn:r=>It(r)},k),h=()=>{u?m.mutate({tg_id:o,points:t},{onSuccess:()=>{k.invalidateQueries({queryKey:["user"]}),e("/")}}):m.mutate({tg_id:o,points:t*2},{onSuccess:()=>{k.invalidateQueries({queryKey:["user"]}),e("/")}}),a.HapticFeedback.impactOccurred("light")};return n.jsx("div",{className:x.container,children:n.jsxs("div",{className:x.container_content,children:[n.jsx("p",{className:x.title_game_prize,children:"Твоя награда:"}),n.jsxs("div",{className:x.coin_box,children:[n.jsx("img",{src:K,width:32,height:32}),n.jsx("span",{className:x.text_coin,style:u?{background:"none"}:{background:"#3D3BFF"},children:u?t:t*2})]}),n.jsx("button",{onClick:h,className:x.back_home_button,children:"Забрать награду"})]})})}function Ut(){const[t,e]=l.useState(!0),[a,o]=l.useState(15),[u,m]=l.useState(0),[h,r]=l.useState([]),[s,c]=l.useState([]),[i,f]=l.useState([]),{tg:p,tg_id:j}=b(),O=C(U),y=B({mutationFn:_=>Mt(_)},k),R={tg_id:j,tickets:1},q={tg_id:j,premium_tickets:1};l.useEffect(()=>{O?y.mutate(R):y.mutate(q)},[]),l.useEffect(()=>{const _=setInterval(()=>{r(v=>{const S=xt.map(H=>({...H,id:g(),duration:Math.random()+1.8}));return[...v,...S]})},800);return()=>clearInterval(_)},[]);const G=_=>{r(v=>v.filter(S=>S.id!==_)),m(v=>v+1),p.HapticFeedback.impactOccurred("light")};return n.jsx(bt,{children:y.isPending?n.jsx(P,{}):n.jsxs("div",{className:N.falling_letters_container,children:[n.jsx(st,{time:a,setTimer:o,setIsVision:e}),n.jsx("img",{width:69,height:15,src:A,className:N.logo}),n.jsx(dt,{count:u}),n.jsx("img",{src:z,className:N.img_open_box}),t?n.jsxs(n.Fragment,{children:[h.map(_=>n.jsx(Z,{onClick:()=>G(_.id),id:_.id,x:_.x,duration:_.duration},_.id)),n.jsx(rt,{setCount:m,blueLetter:s,setBlueLetter:c}),n.jsx(ht,{setCount:o,flasks:i,setFlask:f}),n.jsx(_t,{setCount:m,setWhiteLetter:r,setBlueLetter:c,setFlask:f})]}):n.jsx(wt,{finalPoints:u})]})})}export{Ut as default};
