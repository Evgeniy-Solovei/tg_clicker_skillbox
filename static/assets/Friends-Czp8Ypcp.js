import{u as j,j as e,r as o}from"./index-Dp4qazyM.js";import{a as N,P as q}from"./PageUI-C8yc6MWC.js";import{u as x}from"./useQuery-D8SANtub.js";import{b as y,c as F,f as S}from"./fetchFriends-CDow6dY1.js";import{q as g}from"./queryClient-baB-ws9R.js";import{u as C}from"./useMutation-CWbDCWUu.js";import{i as w}from"./coin-DlK3Y3AM.js";import{S as D}from"./SlidingPanel-CHqcJ7H9.js";import{f as H}from"./friends__invite-Ds21nNo3.js";import{H as L}from"./HeaderCoinSvg-BsEuWYJU.js";const $="_friends__section_1kllm_1",E="_friends__title_1kllm_6",O="_friends__invite_1kllm_10",R="_invite__title_1kllm_23",T="_invite__label_1kllm_31",I="_invite__button_1kllm_39",P="_page__list_1kllm_50",a={friends__section:$,friends__title:E,friends__invite:O,invite__title:R,invite__label:T,invite__button:I,page__list:P},U="_friends__item_3q1nm_1",A="_friends__position_3q1nm_19",K="_friends__avatar_3q1nm_33",M="_friends__info_3q1nm_45",Q="_friends__name_3q1nm_57",z="_friends__coins_3q1nm_69",B="_icon_coin_3q1nm_81",Y="_friends__button_3q1nm_93",G="_friends_reg_data_3q1nm_121",n={friends__item:U,friends__position:A,friends__avatar:K,friends__info:M,friends__name:Q,friends__coins:z,icon_coin:B,friends__button:Y,friends_reg_data:G};function J(i){const s=new Date(i),t=String(s.getUTCDate()).padStart(2,"0"),_=String(s.getUTCMonth()+1).padStart(2,"0"),l=String(s.getUTCFullYear()).slice(-2);return`${t}.${_}.${l}`}function f({friends:i,index:s,isOpen:t,isDisabled:_}){const{tg:l,tg_id:u}=j(),p=C({mutationFn:r=>y(r.tg_id,r.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&t(!0)},onError:r=>{console.log(r)}},g),c=()=>{p.mutate({tg_id:u,new_player_id:i.tg_id}),l.HapticFeedback.impactOccurred("light")};return e.jsxs("li",{className:n.friends__item,children:[e.jsx("span",{className:n.friends__position,children:s+1}),e.jsx("img",{className:n.friends__avatar,src:N,alt:"avatar"}),e.jsxs("div",{className:n.friends__info,children:[e.jsx("p",{className:n.friends__name,children:i==null?void 0:i.name}),e.jsxs("div",{className:n.icon_coin,children:[e.jsx("img",{width:12,height:12,className:n.iconCoin,src:w,alt:""}),e.jsx("p",{className:n.friends__coins,children:i==null?void 0:i.points})]})]}),i.referral_bonus?e.jsx("button",{disabled:_,onClick:c,className:n.friends__button,children:"Забрать награду"}):e.jsxs("span",{className:n.friends_reg_data,children:["Приглашён ",J(i.reg_data)]})]})}const V="_sliding__button_qswlm_1",W="_sliding__block_qswlm_8",X="_sliding__image_qswlm_20",Z="_sliding__title_qswlm_24",ee="_sliding__label_qswlm_32",d={sliding__button:V,sliding__block:W,sliding__image:X,sliding__title:Z,sliding__label:ee},ie=({isOpen:i,onClose:s,fullHeight:t,initialHeight:_})=>e.jsx(D,{initialHeight:_,fullHeight:t,darkened:!0,isOpen:i,onClose:s,children:e.jsxs("div",{className:d.sliding__block,children:[e.jsx("img",{className:d.sliding__image,width:215,height:215,src:H,alt:""}),e.jsx("h2",{className:d.sliding__title,children:"Твоя награда:"}),e.jsxs("p",{className:d.sliding__label,children:[e.jsx(L,{}),e.jsx("span",{children:"500"})]}),e.jsx("button",{onClick:s,className:d.sliding__button,children:"Ура!"})]})});function me(){const{tg:i,tg_id:s}=j(),[t,_]=o.useState([]),[l,u]=o.useState(""),[p,c]=o.useState(!1),r=()=>{c(!1)},v=()=>{const m=`https://t.me/share/url?url=${l}`;i.openTelegramLink(m),i.HapticFeedback.impactOccurred("light")},h=x({queryKey:["refLink"],queryFn:()=>F(s)},g),{data:b}=x({queryKey:["friends"],queryFn:()=>S(s)},g);return o.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),o.useEffect(()=>{b&&_(b)},[b]),e.jsxs(e.Fragment,{children:[e.jsxs(q,{className:a.friends__section,className__title:a.friends__title,title:"Друзья",children:[e.jsxs("div",{className:a.friends__invite,children:[e.jsx("h2",{className:a.invite__title,children:"Играть вместе веселее!"}),e.jsx("p",{className:a.invite__label,children:"Получай награды за каждого друга, который присоединился"}),e.jsx("button",{className:a.invite__button,onClick:v,children:"Пригласить друга"})]}),e.jsxs("ul",{className:a.page__list,children:[t.map((m,k)=>e.jsx(f,{isOpen:c,friends:m,index:k,isDisabled:!1},m.tg_id)),t.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",e.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",e.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),e.jsx(ie,{isOpen:p,onClose:r,initialHeight:"70%",fullHeight:"70vh"})]})}export{me as default};
