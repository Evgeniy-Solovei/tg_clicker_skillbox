import{u as x,j as i,r as c}from"./index-BShHW87Y.js";import{a as v,P as N}from"./avatar-ClnU0roo.js";import{b as y,u as F,f as q,c as S}from"./fetchFriends-DXRPB-Vp.js";import{u as C}from"./useSuspenseQuery-pf-dkvI8.js";import{q as g}from"./queryClient-IYkmngvS.js";import{u as H}from"./useMutation-Cvijl-uf.js";import{i as O}from"./coin-_wPR_gfl.js";import{S as D}from"./SlidingPanel-C14IX4fO.js";import{f as L}from"./friends__invite-Ds21nNo3.js";import{H as $}from"./HeaderCoinSvg-C9QI19X2.js";import"./formatNumber-B2gvpCqi.js";const w="_friends__section_1kllm_1",R="_friends__title_1kllm_6",T="_friends__invite_1kllm_10",E="_invite__title_1kllm_23",I="_invite__label_1kllm_31",P="_invite__button_1kllm_39",U="_page__list_1kllm_50",r={friends__section:w,friends__title:R,friends__invite:T,invite__title:E,invite__label:I,invite__button:P,page__list:U},A="_friends__item_3q1nm_1",K="_friends__position_3q1nm_19",Q="_friends__avatar_3q1nm_33",M="_friends__info_3q1nm_45",z="_friends__name_3q1nm_57",B="_friends__coins_3q1nm_69",Y="_icon_coin_3q1nm_81",G="_friends__button_3q1nm_93",J="_friends_reg_data_3q1nm_121",n={friends__item:A,friends__position:K,friends__avatar:Q,friends__info:M,friends__name:z,friends__coins:B,icon_coin:Y,friends__button:G,friends_reg_data:J};function V(e){const s=new Date(e),t=String(s.getUTCDate()).padStart(2,"0"),a=String(s.getUTCMonth()+1).padStart(2,"0"),_=String(s.getUTCFullYear()).slice(-2);return`${t}.${a}.${_}`}function f({friends:e,index:s,isOpen:t,isDisabled:a}){const{tg:_,tg_id:u}=x(),p=H({mutationFn:d=>y(d.tg_id,d.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&(t(!0),_.HapticFeedback.impactOccurred("light"))}},g),o=()=>{p.mutate({tg_id:u,new_player_id:e.tg_id}),_.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:n.friends__item,children:[i.jsx("span",{className:n.friends__position,children:s+1}),i.jsx("img",{className:n.friends__avatar,src:v,alt:"avatar"}),i.jsxs("div",{className:n.friends__info,children:[i.jsx("p",{className:n.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:n.icon_coin,children:[i.jsx("img",{width:12,height:12,className:n.iconCoin,src:O,alt:""}),i.jsx("p",{className:n.friends__coins,children:e==null?void 0:e.points})]})]}),e.referral_bonus?i.jsx("button",{disabled:a,onClick:o,className:n.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:n.friends_reg_data,children:["Приглашён ",V(e.reg_data)]})]})}const W="_sliding__button_1ialg_1",X="_sliding__block_1ialg_15",Z="_sliding__image_1ialg_28",ii="_sliding__title_1ialg_32",ei="_sliding__label_1ialg_40",si="_count_coin_1ialg_51",l={sliding__button:W,sliding__block:X,sliding__image:Z,sliding__title:ii,sliding__label:ei,count_coin:si},ni=({isOpen:e,onClose:s,fullHeight:t,initialHeight:a})=>{const{tg:_}=x();return i.jsx(D,{initialHeight:a,fullHeight:t,darkened:!0,isOpen:e,onClose:s,children:i.jsxs("div",{className:l.sliding__block,children:[i.jsx("img",{className:l.sliding__image,width:215,height:215,src:L,alt:""}),i.jsx("h2",{className:l.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:l.sliding__label,children:[i.jsx($,{}),i.jsx("span",{className:l.count_coin,children:"500"})]}),i.jsx("button",{onClick:()=>{s(),_.HapticFeedback.impactOccurred("light")},className:l.sliding__button,children:"Ура!"})]})})};function ui(){const{tg:e,tg_id:s}=x(),[t,a]=c.useState([]),[_,u]=c.useState(""),[p,o]=c.useState(!1),d=()=>{o(!1),e.HapticFeedback.impactOccurred("light")},j=()=>{const m=`https://t.me/share/url?url=${_}`;e.openTelegramLink(m),e.HapticFeedback.impactOccurred("light")},h=F({queryKey:["refLink"],queryFn:()=>S(s)},g),{data:b}=C({queryKey:["friends"],queryFn:()=>q(s)},g);return c.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),c.useEffect(()=>{b&&a(b)},[b]),i.jsxs(i.Fragment,{children:[i.jsxs(N,{className:r.friends__section,className__title:r.friends__title,title:"Друзья",children:[i.jsxs("div",{className:r.friends__invite,children:[i.jsx("h2",{className:r.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:r.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:r.invite__button,onClick:j,children:"Пригласить друга"})]}),i.jsxs("ul",{className:r.page__list,children:[t.map((m,k)=>i.jsx(f,{isOpen:o,friends:m,index:k,isDisabled:!1},m.tg_id)),t.length===0&&i.jsxs(i.Fragment,{children:[i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),i.jsx(ni,{isOpen:p,onClose:d,initialHeight:"70%",fullHeight:"70vh"})]})}export{ui as default};
