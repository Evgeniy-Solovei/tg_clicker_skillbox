var L=e=>{throw TypeError(e)};var $=(e,t,n)=>t.has(e)||L("Cannot "+n);var l=(e,t,n)=>($(e,t,"read from private field"),n?n.call(e):t.get(e)),k=(e,t,n)=>t.has(e)?L("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),w=(e,t,n,s)=>($(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),M=(e,t,n)=>($(e,t,"access private method"),n);import{r as d,j as o,u as O,e as J}from"./index-B0XQjdeZ.js";import{H as Q,l as W,i as Z}from"./skillbox__box-Ca4LNG3_.js";import{S as X,s as Y,h as B,g as tt,n as P,u as et,c as nt,d as st,a as ot,b as it,q}from"./queryClient-B9Ofn6Pj.js";var y,j,g,v,f,E,H,K,at=(K=class extends X{constructor(t,n){super();k(this,f);k(this,y);k(this,j);k(this,g);k(this,v);w(this,y,t),this.setOptions(n),this.bindMethods(),M(this,f,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const n=this.options;this.options=l(this,y).defaultMutationOptions(t),Y(this.options,n)||l(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:l(this,g),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&B(n.mutationKey)!==B(this.options.mutationKey)?this.reset():((s=l(this,g))==null?void 0:s.state.status)==="pending"&&l(this,g).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=l(this,g))==null||t.removeObserver(this)}onMutationUpdate(t){M(this,f,E).call(this),M(this,f,H).call(this,t)}getCurrentResult(){return l(this,j)}reset(){var t;(t=l(this,g))==null||t.removeObserver(this),w(this,g,void 0),M(this,f,E).call(this),M(this,f,H).call(this)}mutate(t,n){var s;return w(this,v,n),(s=l(this,g))==null||s.removeObserver(this),w(this,g,l(this,y).getMutationCache().build(l(this,y),this.options)),l(this,g).addObserver(this),l(this,g).execute(t)}},y=new WeakMap,j=new WeakMap,g=new WeakMap,v=new WeakMap,f=new WeakSet,E=function(){var n;const t=((n=l(this,g))==null?void 0:n.state)??tt();w(this,j,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},H=function(t){P.batch(()=>{var n,s,r,m,_,u,i,c;if(l(this,v)&&this.hasListeners()){const a=l(this,j).variables,x=l(this,j).context;(t==null?void 0:t.type)==="success"?((s=(n=l(this,v)).onSuccess)==null||s.call(n,t.data,a,x),(m=(r=l(this,v)).onSettled)==null||m.call(r,t.data,null,a,x)):(t==null?void 0:t.type)==="error"&&((u=(_=l(this,v)).onError)==null||u.call(_,t.error,a,x),(c=(i=l(this,v)).onSettled)==null||c.call(i,void 0,t.error,a,x))}this.listeners.forEach(a=>{a(l(this,j))})})},K);function rt(e,t){const n=et(t),[s]=d.useState(()=>new at(n,e));d.useEffect(()=>{s.setOptions(e)},[s,e]);const r=d.useSyncExternalStore(d.useCallback(_=>s.subscribe(P.batchCalls(_)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),m=d.useCallback((_,u)=>{s.mutate(_,u).catch(nt)},[s]);if(r.error&&st(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:m,mutateAsync:r.mutate}}const ct="_falling_letters_container_w5uz3_1",ut="_img_open_box_w5uz3_21",lt="_logo_w5uz3_37",D={falling_letters_container:ct,img_open_box:ut,logo:lt},dt="/assets/S-white-DJHRycHD.png",mt=({x:e,duration:t,id:n,onClick:s})=>o.jsxs("button",{className:"btn",onTouchStart:()=>s(n),id:n,style:{left:`${e}%`,animationDuration:`${t}s`},children:[" ",o.jsx("img",{src:dt,className:"falling_letter_white"})]}),h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function ht(e,t=0){return(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase()}let R;const _t=new Uint8Array(16);function gt(){if(!R){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");R=crypto.getRandomValues.bind(crypto)}return R(_t)}const bt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),T={randomUUID:bt};function b(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();e=e||{};const s=e.random||(e.rng||gt)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,ht(s)}const xt="_timer_container_1vdlq_1",pt="_time_1vdlq_1",z={timer_container:xt,time:pt},vt=e=>{const t=Math.floor(e%3600/60),n=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`};function ft({setIsVision:e,time:t,setTimer:n}){return d.useEffect(()=>{const s=setInterval(()=>{n(r=>r>0?r-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[n]),d.useEffect(()=>{t===0&&e(!1)},[t]),o.jsx("div",{className:z.timer_container,children:o.jsx("div",{className:z.time,children:vt(t)})})}const yt="/assets/S-blue-Dh_q71fZ.png",jt=[{id:b(),duration:3,x:38},{id:b(),duration:1,x:58}],St=({setCount:e,blueLetter:t,setBlueLetter:n})=>{const{tg:s}=O(),r=d.useRef([]),[m,_]=d.useState(0),u=i=>{n(c=>c.filter(a=>a.id!==i)),e(c=>c-3),s.HapticFeedback.impactOccurred("light")};return d.useEffect(()=>{const i=setInterval(()=>{if(m<5){const c=jt.map(a=>({...a,id:b(),duration:Math.random()+2}));n(a=>[...a,...c]),_(a=>a+1)}},2e3);return()=>clearInterval(i)},[m]),d.useEffect(()=>{const c=setInterval(()=>{r.current.forEach(a=>{a&&a.getBoundingClientRect().bottom>=window.innerHeight&&(e(N=>N+3),n(N=>N.filter(I=>I.id!==a.id)))})},10);return()=>clearInterval(c)},[t,e,n]),o.jsx(o.Fragment,{children:t.map((i,c)=>o.jsxs("button",{className:"btn_blue",onTouchStart:()=>u(i.id),id:i.id,ref:a=>r.current[c]=a,style:{left:`${i.x}%`,animationDuration:`${i.duration}s`},children:[" ",o.jsx("img",{className:"falling_letter_blue",src:yt})]},i.id))})},kt="_counter_container_47eta_1",wt="_counter_47eta_1",G={counter_container:kt,counter:wt};function Mt({count:e}){return o.jsx("div",{className:G.counter_container,children:o.jsx("div",{className:G.counter,children:e})})}const Nt="/assets/bomb-DeoDqckm.png";function V(){return Math.floor(Math.random()*81)+10}function Ct({setCount:e,setWhiteLetter:t,setBlueLetter:n,setFlask:s}){const[r,m]=d.useState([]),{tg:_}=O(),u=i=>{m(c=>c.filter(a=>a.id!==i)),t([]),n([]),s([]),e(c=>c-10),_.HapticFeedback.impactOccurred("heavy")};return d.useEffect(()=>{const c=setInterval(()=>{const a={x:V(),duration:Math.random()+2,id:b().toString()};m(x=>[...x,a])},4e3);return()=>clearInterval(c)},[]),o.jsx(o.Fragment,{children:r.map(i=>o.jsxs("button",{className:"btn_bomb",onTouchStart:()=>u(i.id),id:i.id,style:{left:`${i.x}%`,animationDuration:`${i.duration}s`},children:[" ",o.jsx("img",{src:Nt,className:"falling_bomb"})]},i.id))})}const Ot="/assets/flask-0VLBKfJP.png";function Et({setCount:e,flasks:t,setFlask:n}){const{tg:s}=O(),r=u=>{n(i=>i.filter(c=>c.id!==u)),e(i=>i+5),s.HapticFeedback.impactOccurred("light")},[m,_]=d.useState(0);return d.useEffect(()=>{const i=setInterval(()=>{if(m<3){const c={x:V(),duration:Math.random()+2,id:b().toString()};n(a=>[...a,c]),_(a=>a+1)}},4200);return()=>clearInterval(i)},[m]),o.jsx(o.Fragment,{children:t.map(u=>o.jsxs("button",{className:"btn_flask",onTouchStart:()=>r(u.id),id:u.id,style:{left:`${u.x}%`,animationDuration:`${u.duration}s`},children:[" ",o.jsx("img",{src:Ot,className:"falling_flask"})]},u.id))})}const It=[{id:b(),duration:Math.random()*3+2,x:5},{id:b(),duration:Math.random()*3+2,x:25},{id:b(),duration:Math.random()*3+2,x:45},{id:b(),duration:Math.random()*3+2,x:65},{id:b(),duration:Math.random()*3+2,x:82}],Ft="_modal_7v2vv_1",$t="_overlay_7v2vv_14",Dt="_content_7v2vv_20",U={modal:Ft,overlay:$t,content:Dt};function Rt({children:e}){return o.jsx("div",{className:U.modal,children:o.jsx("div",{className:U.overlay,children:o.jsx("div",{className:U.content,children:e})})})}const Ut="_container_1jygo_1",Ht="_container_content_1jygo_13",Lt="_title_game_prize_1jygo_41",Bt="_coin_box_1jygo_61",qt="_text_coin_1jygo_77",Tt="_new_game_button_1jygo_91",zt="_back_home_button_1jygo_127",S={container:Ut,container_content:Ht,title_game_prize:Lt,coin_box:Bt,text_coin:qt,new_game_button:Tt,back_home_button:zt};function Gt({tg_id:e,points:t,tickets:n,premium_tickets:s}){return ot.post(`${it}/api/game-result/`,{points:t,tg_id:e,tickets:n,premium_tickets:s}).then(r=>r.data).catch(r=>{console.log(r)})}function Kt({finalPoints:e}){const t=J(),{tg:n,tg_id:s}=O(),r={tg_id:s,points:e,tickets:1},m=rt({mutationFn:i=>Gt(i)},q),_=()=>{n.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{location.reload()}})},u=()=>{n.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{q.invalidateQueries({queryKey:["user"]}),t("/")}})};return o.jsx("div",{className:S.container,children:o.jsxs("div",{className:S.container_content,children:[o.jsx("p",{className:S.title_game_prize,children:"Твоя награда:"}),o.jsxs("div",{className:S.coin_box,children:[o.jsx(Q,{}),o.jsx("span",{className:S.text_coin,children:e})]}),o.jsx("button",{onClick:_,className:S.new_game_button,children:"Новая игра"}),o.jsx("button",{onClick:u,className:S.back_home_button,children:"На главный экран"})]})})}function Qt(){const[e,t]=d.useState(!0),[n,s]=d.useState(15),[r,m]=d.useState(0),[_,u]=d.useState([]),[i,c]=d.useState([]),[a,x]=d.useState([]),{tg:N}=O();d.useEffect(()=>{const p=setInterval(()=>{u(C=>{const F=It.map(A=>({...A,id:b(),duration:Math.random()+1.8}));return[...C,...F]})},800);return()=>clearInterval(p)},[]);const I=p=>{u(C=>C.filter(F=>F.id!==p)),m(C=>C+1),N.HapticFeedback.impactOccurred("light")};return o.jsx(Rt,{children:o.jsxs("div",{className:D.falling_letters_container,children:[o.jsx(ft,{time:n,setTimer:s,setIsVision:t}),o.jsx("img",{src:W,className:D.logo}),o.jsx(Mt,{count:r}),o.jsx("img",{src:Z,className:D.img_open_box}),e?o.jsxs(o.Fragment,{children:[" ",_.map(p=>o.jsx(mt,{onClick:()=>I(p.id),id:p.id,x:p.x,duration:p.duration},p.id)),o.jsx(St,{setCount:m,blueLetter:i,setBlueLetter:c}),o.jsx(Et,{setCount:s,flasks:a,setFlask:x}),o.jsx(Ct,{setCount:m,setWhiteLetter:u,setBlueLetter:c,setFlask:x})]}):o.jsx(Kt,{finalPoints:r})]})})}export{Qt as default};
