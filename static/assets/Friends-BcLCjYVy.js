import{u as b,j as i,r as o}from"./index-C05qCyxB.js";import{a as q,P as N}from"./PageUI-Bmcp094l.js";import{u as h}from"./useQuery-ebfDc9kT.js";import{b as y,c as F,f as S}from"./fetchFriends-QZeTPwL5.js";import{q as m}from"./queryClient-iGymef0F.js";import{u as w}from"./useMutation-n639XdyF.js";import{H as v}from"./HeaderCoinSvg-XaN1cD-8.js";import{S as C}from"./SlidingPanel-BLzmKdlI.js";import{f as H}from"./friends__invite-Ds21nNo3.js";import"./Portal-CllPaqok.js";const L="_friends__section_9k5ar_1",$="_friends__title_9k5ar_6",E="_friends__invite_9k5ar_10",O="_invite__title_9k5ar_23",R="_invite__label_9k5ar_31",T="_invite__button_9k5ar_39",I="_page__list_9k5ar_50",a={friends__section:L,friends__title:$,friends__invite:E,invite__title:O,invite__label:R,invite__button:T,page__list:I},P="_friends__item_3q1nm_1",U="_friends__position_3q1nm_19",A="_friends__avatar_3q1nm_33",D="_friends__info_3q1nm_45",K="_friends__name_3q1nm_57",M="_friends__coins_3q1nm_69",Q="_icon_coin_3q1nm_81",z="_friends__button_3q1nm_93",B="_friends_reg_data_3q1nm_121",s={friends__item:P,friends__position:U,friends__avatar:A,friends__info:D,friends__name:K,friends__coins:M,icon_coin:Q,friends__button:z,friends_reg_data:B};function Y(e){const n=new Date(e),t=String(n.getUTCDate()).padStart(2,"0"),_=String(n.getUTCMonth()+1).padStart(2,"0"),l=String(n.getUTCFullYear()).slice(-2);return`${t}.${_}.${l}`}function G({friends:e,index:n}){const{tg:t,tg_id:_}=b(),l=w({mutationFn:r=>y(r.tg_id,r.new_player_id),onSuccess:()=>{m.invalidateQueries({queryKey:["friends"]})},onError:r=>{console.log(r)}},m),f=()=>{l.mutate({tg_id:_,new_player_id:e.tg_id}),t.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:s.friends__item,children:[i.jsx("span",{className:s.friends__position,children:n+1}),i.jsx("img",{className:s.friends__avatar,src:q,alt:"avatar"}),i.jsxs("div",{className:s.friends__info,children:[i.jsx("p",{className:s.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:s.icon_coin,children:[i.jsx(v,{width:"12",height:"12"}),i.jsx("p",{className:s.friends__coins,children:e==null?void 0:e.points})]})]}),e.referral_bonus?i.jsx("button",{onClick:f,className:s.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:s.friends_reg_data,children:["Приглашён ",Y(e.reg_data)]})]})}const J="_sliding__button_qswlm_1",V="_sliding__block_qswlm_8",W="_sliding__image_qswlm_20",X="_sliding__title_qswlm_24",Z="_sliding__label_qswlm_32",c={sliding__button:J,sliding__block:V,sliding__image:W,sliding__title:X,sliding__label:Z},ii=({isOpen:e,onClose:n,fullHeight:t,initialHeight:_})=>i.jsx(C,{initialHeight:_,fullHeight:t,darkened:!0,isOpen:e,onClose:n,children:i.jsxs("div",{className:c.sliding__block,children:[i.jsx("img",{className:c.sliding__image,width:215,height:215,src:H,alt:""}),i.jsx("h2",{className:c.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:c.sliding__label,children:[i.jsx(v,{}),i.jsx("span",{children:"500"})]}),i.jsx("button",{onClick:n,className:c.sliding__button,children:"Ура!"})]})});function di(){const{tg:e,tg_id:n}=b(),[t,_]=o.useState([]),[l,f]=o.useState(""),[r,p]=o.useState(!1),x=()=>{p(!1)},j=()=>{const d=`https://t.me/share/url?url=${l}`;e.openTelegramLink(d),e.HapticFeedback.impactOccurred("light"),p(!0)},g=h({queryKey:["refLink"],queryFn:()=>F(n)},m),{data:u}=h({queryKey:["friends"],queryFn:()=>S(n)},m);return o.useEffect(()=>{g.data&&f(g.data.ref_link)},[g]),o.useEffect(()=>{u&&_(u)},[u]),i.jsxs(i.Fragment,{children:[i.jsxs(N,{className:a.friends__section,className__title:a.friends__title,title:"Друзья",children:[i.jsxs("div",{className:a.friends__invite,children:[i.jsx("h2",{className:a.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:a.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:a.invite__button,onClick:j,children:"Пригласить друга"})]}),i.jsx("ul",{className:a.page__list,children:t.map((d,k)=>i.jsx(G,{friends:d,index:k},d.tg_id))})]}),i.jsx(ii,{isOpen:r,onClose:x,initialHeight:"70%",fullHeight:"70vh"})]})}export{di as default};
