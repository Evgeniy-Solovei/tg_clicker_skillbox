import{u as g,j as e,r as d}from"./index-kG2vqxm4.js";import{P as v}from"./PageUI-DxofWQRV.js";import{u as m}from"./useQuery-CSGlswJT.js";import{a as x,b as h,f as b}from"./fetchFriends-Q10SqL7W.js";import{q as l}from"./queryClient-B6smZHaN.js";import{u as k}from"./useMutation-DQTPHnV2.js";const j="_friends__section_9k5ar_1",y="_friends__title_9k5ar_6",q="_friends__invite_9k5ar_10",N="_invite__title_9k5ar_23",F="_invite__label_9k5ar_31",S="_invite__button_9k5ar_39",C="_page__list_9k5ar_50",n={friends__section:j,friends__title:y,friends__invite:q,invite__title:N,invite__label:F,invite__button:S,page__list:C},L="_friends__item_vix5q_1",E="_friends__position_vix5q_19",R="_friends__avatar_vix5q_33",T="_friends__info_vix5q_41",$="_friends__name_vix5q_53",U="_friends__coins_vix5q_65",w="_friends__button_vix5q_77",A="_friends_reg_data_vix5q_105",_={friends__item:L,friends__position:E,friends__avatar:R,friends__info:T,friends__name:$,friends__coins:U,friends__button:w,friends_reg_data:A};function D(t){const i=new Date(t),r=String(i.getUTCDate()).padStart(2,"0"),a=String(i.getUTCMonth()+1).padStart(2,"0"),o=String(i.getUTCFullYear()).slice(-2);return`${r}.${a}.${o}`}function K({friends:t}){const{tg:i,tg_id:r}=g(),a=k({mutationFn:s=>x(s.tg_id,s.new_player_id),onSuccess:()=>{l.invalidateQueries({queryKey:["friends"]})},onError:s=>{console.log(s)}},l),o=()=>{a.mutate({tg_id:r,new_player_id:t.tg_id}),i.HapticFeedback.impactOccurred("light")};return e.jsxs("li",{className:_.friends__item,children:[e.jsx("span",{className:_.friends__position,children:"1"}),e.jsx("img",{className:_.friends__avatar,src:"avatar",alt:"avatar"}),e.jsxs("div",{className:_.friends__info,children:[e.jsx("p",{className:_.friends__name,children:t==null?void 0:t.name}),e.jsx("p",{className:_.friends__coins,children:t==null?void 0:t.points})]}),t.referral_bonus?e.jsx("button",{onClick:o,className:_.friends__button,children:"Забрать награду"}):e.jsxs("span",{className:_.friends_reg_data,children:["Приглашён ",D(t.reg_data)]})]})}function z(){const{tg:t,tg_id:i}=g(),[r,a]=d.useState([]),[o,s]=d.useState(""),p=()=>{const c=`https://t.me/share/url?url=${o}`;t.openTelegramLink(c),t.HapticFeedback.impactOccurred("light")},f=m({queryKey:["refLink"],queryFn:()=>h(i)},l),{data:u}=m({queryKey:["friends"],queryFn:()=>b(i)},l);return d.useEffect(()=>{f.data&&s(f.data.ref_link)},[f]),d.useEffect(()=>{u&&a(u)},[u]),e.jsxs(v,{className:n.friends__section,className__title:n.friends__title,title:"Друзья",children:[e.jsxs("div",{className:n.friends__invite,children:[e.jsx("h2",{className:n.invite__title,children:"Играть вместе веселее!"}),e.jsx("p",{className:n.invite__label,children:"Получай награды за каждого друга, который присоединился"}),e.jsx("button",{className:n.invite__button,onClick:p,children:"Пригласить друга"})]}),e.jsx("ul",{className:n.page__list,children:r.map(c=>e.jsx(K,{friends:c},c.tg_id))})]})}export{z as default};
