import{j as n,r as d,u as f,e as D}from"./index-kG2vqxm4.js";import{H as E,l as H,i as U}from"./skillbox__box-uvF9zXqy.js";import{u as B}from"./useMutation-DQTPHnV2.js";import{a as R,b as L,q as w}from"./queryClient-B6smZHaN.js";const O="_falling_letters_container_w5uz3_1",q="_img_open_box_w5uz3_21",z="_logo_w5uz3_37",k={falling_letters_container:O,img_open_box:q,logo:z},G="/assets/S-white-DJHRycHD.png",T=({x:t,duration:e,id:a,onClick:s})=>n.jsxs("button",{className:"btn",onTouchStart:()=>s(a),id:a,style:{left:`${t}%`,animationDuration:`${e}s`},children:[" ",n.jsx("img",{src:G,className:"falling_letter_white"})]}),u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));function V(t,e=0){return(u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]).toLowerCase()}let S;const P=new Uint8Array(16);function A(){if(!S){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");S=crypto.getRandomValues.bind(crypto)}return S(P)}const J=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:J};function _(t,e,a){if(I.randomUUID&&!e&&!t)return I.randomUUID();t=t||{};const s=t.random||(t.rng||A)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,V(s)}const K="_timer_container_1vdlq_1",W="_time_1vdlq_1",F={timer_container:K,time:W},Q=t=>{const e=Math.floor(t%3600/60),a=t%60;return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};function Z({setIsVision:t,time:e,setTimer:a}){return d.useEffect(()=>{const s=setInterval(()=>{a(r=>r>0?r-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[a]),d.useEffect(()=>{e===0&&t(!1)},[e]),n.jsx("div",{className:F.timer_container,children:n.jsx("div",{className:F.time,children:Q(e)})})}const X="/assets/S-blue-Dh_q71fZ.png",Y=[{id:_(),duration:3,x:38},{id:_(),duration:1,x:58}],tt=({setCount:t,blueLetter:e,setBlueLetter:a})=>{const{tg:s}=f(),r=d.useRef([]),[m,g]=d.useState(0),l=o=>{a(i=>i.filter(c=>c.id!==o)),t(i=>i-3),s.HapticFeedback.impactOccurred("light")};return d.useEffect(()=>{const o=setInterval(()=>{if(m<5){const i=Y.map(c=>({...c,id:_(),duration:Math.random()+2}));a(c=>[...c,...i]),g(c=>c+1)}},2e3);return()=>clearInterval(o)},[m]),d.useEffect(()=>{const i=setInterval(()=>{r.current.forEach(c=>{c&&c.getBoundingClientRect().bottom>=window.innerHeight&&(t(b=>b+3),a(b=>b.filter(j=>j.id!==c.id)))})},10);return()=>clearInterval(i)},[e,t,a]),n.jsx(n.Fragment,{children:e.map((o,i)=>n.jsxs("button",{className:"btn_blue",onTouchStart:()=>l(o.id),id:o.id,ref:c=>r.current[i]=c,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",n.jsx("img",{className:"falling_letter_blue",src:X})]},o.id))})},nt="_counter_container_47eta_1",et="_counter_47eta_1",M={counter_container:nt,counter:et};function ot({count:t}){return n.jsx("div",{className:M.counter_container,children:n.jsx("div",{className:M.counter,children:t})})}const at="/assets/bomb-DeoDqckm.png";function C(){return Math.floor(Math.random()*81)+10}function st({setCount:t,setWhiteLetter:e,setBlueLetter:a,setFlask:s}){const[r,m]=d.useState([]),{tg:g}=f(),l=o=>{m(i=>i.filter(c=>c.id!==o)),e([]),a([]),s([]),t(i=>i-10),g.HapticFeedback.impactOccurred("heavy")};return d.useEffect(()=>{const i=setInterval(()=>{const c={x:C(),duration:Math.random()+2,id:_().toString()};m(p=>[...p,c])},4e3);return()=>clearInterval(i)},[]),n.jsx(n.Fragment,{children:r.map(o=>n.jsxs("button",{className:"btn_bomb",onTouchStart:()=>l(o.id),id:o.id,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",n.jsx("img",{src:at,className:"falling_bomb"})]},o.id))})}const ct="/assets/flask-0VLBKfJP.png";function it({setCount:t,flasks:e,setFlask:a}){const{tg:s}=f(),r=l=>{a(o=>o.filter(i=>i.id!==l)),t(o=>o+5),s.HapticFeedback.impactOccurred("light")},[m,g]=d.useState(0);return d.useEffect(()=>{const o=setInterval(()=>{if(m<3){const i={x:C(),duration:Math.random()+2,id:_().toString()};a(c=>[...c,i]),g(c=>c+1)}},4200);return()=>clearInterval(o)},[m]),n.jsx(n.Fragment,{children:e.map(l=>n.jsxs("button",{className:"btn_flask",onTouchStart:()=>r(l.id),id:l.id,style:{left:`${l.x}%`,animationDuration:`${l.duration}s`},children:[" ",n.jsx("img",{src:ct,className:"falling_flask"})]},l.id))})}const rt=[{id:_(),duration:Math.random()*3+2,x:5},{id:_(),duration:Math.random()*3+2,x:25},{id:_(),duration:Math.random()*3+2,x:45},{id:_(),duration:Math.random()*3+2,x:65},{id:_(),duration:Math.random()*3+2,x:82}],lt="_modal_7v2vv_1",ut="_overlay_7v2vv_14",dt="_content_7v2vv_20",N={modal:lt,overlay:ut,content:dt};function mt({children:t}){return n.jsx("div",{className:N.modal,children:n.jsx("div",{className:N.overlay,children:n.jsx("div",{className:N.content,children:t})})})}const _t="_container_1jygo_1",gt="_container_content_1jygo_13",xt="_title_game_prize_1jygo_41",ht="_coin_box_1jygo_61",pt="_text_coin_1jygo_77",bt="_new_game_button_1jygo_91",vt="_back_home_button_1jygo_127",h={container:_t,container_content:gt,title_game_prize:xt,coin_box:ht,text_coin:pt,new_game_button:bt,back_home_button:vt};function ft({tg_id:t,points:e,tickets:a,premium_tickets:s}){return R.post(`${L}/api/game-result/`,{points:e,tg_id:t,tickets:a,premium_tickets:s}).then(r=>r.data).catch(r=>{console.log(r)})}function jt({finalPoints:t}){const e=D(),{tg:a,tg_id:s}=f(),r={tg_id:s,points:t,tickets:1},m=B({mutationFn:o=>ft(o)},w),g=()=>{a.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{location.reload()}})},l=()=>{a.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{w.invalidateQueries({queryKey:["user"]}),e("/")}})};return n.jsx("div",{className:h.container,children:n.jsxs("div",{className:h.container_content,children:[n.jsx("p",{className:h.title_game_prize,children:"Твоя награда:"}),n.jsxs("div",{className:h.coin_box,children:[n.jsx(E,{}),n.jsx("span",{className:h.text_coin,children:t})]}),n.jsx("button",{onClick:g,className:h.new_game_button,children:"Новая игра"}),n.jsx("button",{onClick:l,className:h.back_home_button,children:"На главный экран"})]})})}function wt(){const[t,e]=d.useState(!0),[a,s]=d.useState(15),[r,m]=d.useState(0),[g,l]=d.useState([]),[o,i]=d.useState([]),[c,p]=d.useState([]),{tg:b}=f();d.useEffect(()=>{const x=setInterval(()=>{l(v=>{const y=rt.map($=>({...$,id:_(),duration:Math.random()+1.8}));return[...v,...y]})},800);return()=>clearInterval(x)},[]);const j=x=>{l(v=>v.filter(y=>y.id!==x)),m(v=>v+1),b.HapticFeedback.impactOccurred("light")};return n.jsx(mt,{children:n.jsxs("div",{className:k.falling_letters_container,children:[n.jsx(Z,{time:a,setTimer:s,setIsVision:e}),n.jsx("img",{src:H,className:k.logo}),n.jsx(ot,{count:r}),n.jsx("img",{src:U,className:k.img_open_box}),t?n.jsxs(n.Fragment,{children:[" ",g.map(x=>n.jsx(T,{onClick:()=>j(x.id),id:x.id,x:x.x,duration:x.duration},x.id)),n.jsx(tt,{setCount:m,blueLetter:o,setBlueLetter:i}),n.jsx(it,{setCount:s,flasks:c,setFlask:p}),n.jsx(st,{setCount:m,setWhiteLetter:l,setBlueLetter:i,setFlask:p})]}):n.jsx(jt,{finalPoints:r})]})})}export{wt as default};
