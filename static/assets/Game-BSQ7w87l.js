import{j as n,r as d,u as f,e as D}from"./index-CQhpQE_T.js";import{H as E,l as H,i as U}from"./skillbox__box-CATr0AxZ.js";import{u as B}from"./useMutation-CimZEWUZ.js";import{a as R,b as L,q as w}from"./queryClient-CcKTKV8Q.js";const O="_falling_letters_container_w5uz3_1",q="_img_open_box_w5uz3_21",z="_logo_w5uz3_37",k={falling_letters_container:O,img_open_box:q,logo:z},G="/assets/S-white-DJHRycHD.png",T=({x:t,duration:e,id:o,onClick:s})=>n.jsxs("button",{className:"btn",onTouchStart:()=>s(o),id:o,style:{left:`${t}%`,animationDuration:`${e}s`},children:[" ",n.jsx("img",{src:G,className:"falling_letter_white"})]}),u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));function V(t,e=0){return(u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]).toLowerCase()}let S;const P=new Uint8Array(16);function A(){if(!S){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");S=crypto.getRandomValues.bind(crypto)}return S(P)}const J=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:J};function _(t,e,o){if(I.randomUUID&&!e&&!t)return I.randomUUID();t=t||{};const s=t.random||(t.rng||A)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,V(s)}const K="_timer_container_1vdlq_1",W="_time_1vdlq_1",F={timer_container:K,time:W},Q=t=>{const e=Math.floor(t%3600/60),o=t%60;return`${e.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`};function Z({setIsVision:t,time:e,setTimer:o}){return d.useEffect(()=>{const s=setInterval(()=>{o(r=>r>0?r-1:(clearInterval(s),0))},1e3);return()=>clearInterval(s)},[o]),d.useEffect(()=>{e===0&&t(!1)},[e]),n.jsx("div",{className:F.timer_container,children:n.jsx("div",{className:F.time,children:Q(e)})})}const X="/assets/S-blue-Dh_q71fZ.png",Y=[{id:_(),duration:3,x:38},{id:_(),duration:1,x:58}],tt=({setCount:t,blueLetter:e,setBlueLetter:o})=>{const{tg:s}=f(),r=d.useRef([]),[m,h]=d.useState(0),l=a=>{o(i=>i.filter(c=>c.id!==a)),t(i=>i-3),s.HapticFeedback.impactOccurred("light")};return d.useEffect(()=>{const a=setInterval(()=>{if(m<5){const i=Y.map(c=>({...c,id:_(),duration:Math.random()+2}));o(c=>[...c,...i]),h(c=>c+1)}},2e3);return()=>clearInterval(a)},[m]),d.useEffect(()=>{const i=setInterval(()=>{r.current.forEach(c=>{c&&c.getBoundingClientRect().bottom>=window.innerHeight&&(t(p=>p+3),o(p=>p.filter(j=>j.id!==c.id)))})},10);return()=>clearInterval(i)},[e,t,o]),n.jsx(n.Fragment,{children:e.map((a,i)=>n.jsxs("button",{className:"btn_blue",onTouchStart:()=>l(a.id),id:a.id,ref:c=>r.current[i]=c,style:{left:`${a.x}%`,animationDuration:`${a.duration}s`},children:[" ",n.jsx("img",{className:"falling_letter_blue",src:X})]},a.id))})},nt="_counter_container_47eta_1",et="_counter_47eta_1",M={counter_container:nt,counter:et};function at({count:t}){return n.jsx("div",{className:M.counter_container,children:n.jsx("div",{className:M.counter,children:t})})}const ot="/assets/bomb-DeoDqckm.png";function C(){return Math.floor(Math.random()*81)+10}function st({setCount:t,setWhiteLetter:e,setBlueLetter:o,setFlask:s}){const[r,m]=d.useState([]),{tg:h}=f(),l=a=>{m(i=>i.filter(c=>c.id!==a)),e([]),o([]),s([]),t(i=>i-10),h.HapticFeedback.impactOccurred("heavy")};return d.useEffect(()=>{const i=setInterval(()=>{const c={x:C(),duration:Math.random()+2,id:_().toString()};m(v=>[...v,c])},4e3);return()=>clearInterval(i)},[]),n.jsx(n.Fragment,{children:r.map(a=>n.jsxs("button",{className:"btn_bomb",onTouchStart:()=>l(a.id),id:a.id,style:{left:`${a.x}%`,animationDuration:`${a.duration}s`},children:[" ",n.jsx("img",{src:ot,className:"falling_bomb"})]},a.id))})}const ct="/assets/flask-0VLBKfJP.png";function it({setCount:t,flasks:e,setFlask:o}){const{tg:s}=f(),r=l=>{o(a=>a.filter(i=>i.id!==l)),t(a=>a+5),s.HapticFeedback.impactOccurred("light")},[m,h]=d.useState(0);return d.useEffect(()=>{const a=setInterval(()=>{if(m<3){const i={x:C(),duration:Math.random()+2,id:_().toString()};o(c=>[...c,i]),h(c=>c+1)}},4200);return()=>clearInterval(a)},[m]),n.jsx(n.Fragment,{children:e.map(l=>n.jsxs("button",{className:"btn_flask",onTouchStart:()=>r(l.id),id:l.id,style:{left:`${l.x}%`,animationDuration:`${l.duration}s`},children:[" ",n.jsx("img",{src:ct,className:"falling_flask"})]},l.id))})}const rt=[{id:_(),duration:Math.random()*3+2,x:5},{id:_(),duration:Math.random()*3+2,x:25},{id:_(),duration:Math.random()*3+2,x:45},{id:_(),duration:Math.random()*3+2,x:65},{id:_(),duration:Math.random()*3+2,x:82}],lt="_modal_7v2vv_1",ut="_overlay_7v2vv_14",dt="_content_7v2vv_20",N={modal:lt,overlay:ut,content:dt};function mt({children:t}){return n.jsx("div",{className:N.modal,children:n.jsx("div",{className:N.overlay,children:n.jsx("div",{className:N.content,children:t})})})}const _t="_container_1hv2h_1",ht="_container_content_1hv2h_13",gt="_title_game_prize_1hv2h_41",xt="_coin_box_1hv2h_61",vt="_text_coin_1hv2h_77",pt="_new_game_button_1hv2h_101",bt="_back_home_button_1hv2h_137",x={container:_t,container_content:ht,title_game_prize:gt,coin_box:xt,text_coin:vt,new_game_button:pt,back_home_button:bt};function ft({tg_id:t,points:e,tickets:o,premium_tickets:s}){return R.post(`${L}/api/game-result/`,{points:e,tg_id:t,tickets:o,premium_tickets:s}).then(r=>r.data).catch(r=>{console.log(r)})}function jt({finalPoints:t}){const e=D(),{tg:o,tg_id:s}=f(),r={tg_id:s,points:t,tickets:1},m=B({mutationFn:a=>ft(a)},w),h=()=>{o.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{location.reload()}})},l=()=>{o.HapticFeedback.impactOccurred("light"),m.mutate(r,{onSuccess:()=>{w.invalidateQueries({queryKey:["user"]}),e("/")}})};return n.jsx("div",{className:x.container,children:n.jsxs("div",{className:x.container_content,children:[n.jsx("p",{className:x.title_game_prize,children:"Твоя награда:"}),n.jsxs("div",{className:x.coin_box,children:[n.jsx(E,{}),n.jsx("span",{className:x.text_coin,style:{background:"none"},children:t})]}),n.jsx("button",{onClick:h,className:x.new_game_button,children:"Новая игра"}),n.jsx("button",{onClick:l,className:x.back_home_button,children:"На главный экран"})]})})}function wt(){const[t,e]=d.useState(!0),[o,s]=d.useState(15),[r,m]=d.useState(0),[h,l]=d.useState([]),[a,i]=d.useState([]),[c,v]=d.useState([]),{tg:p}=f();d.useEffect(()=>{const g=setInterval(()=>{l(b=>{const y=rt.map($=>({...$,id:_(),duration:Math.random()+1.8}));return[...b,...y]})},800);return()=>clearInterval(g)},[]);const j=g=>{l(b=>b.filter(y=>y.id!==g)),m(b=>b+1),p.HapticFeedback.impactOccurred("light")};return n.jsx(mt,{children:n.jsxs("div",{className:k.falling_letters_container,children:[n.jsx(Z,{time:o,setTimer:s,setIsVision:e}),n.jsx("img",{src:H,className:k.logo}),n.jsx(at,{count:r}),n.jsx("img",{src:U,className:k.img_open_box}),t?n.jsxs(n.Fragment,{children:[" ",h.map(g=>n.jsx(T,{onClick:()=>j(g.id),id:g.id,x:g.x,duration:g.duration},g.id)),n.jsx(tt,{setCount:m,blueLetter:a,setBlueLetter:i}),n.jsx(it,{setCount:s,flasks:c,setFlask:v}),n.jsx(st,{setCount:m,setWhiteLetter:l,setBlueLetter:i,setFlask:v})]}):n.jsx(jt,{finalPoints:r})]})})}export{wt as default};
