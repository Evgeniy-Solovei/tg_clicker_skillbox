import{j as e,r as m,u as v,f as D,e as F}from"./index-rbZjz3ed.js";import{i as E}from"./skillbox__box-DbP8mP4Q.js";import{l as H}from"./logo-exXQDy5k.js";import{H as U}from"./HeaderCoinSvg-wUf429Zw.js";import{u as B}from"./useMutation-CzJk5Uro.js";import{a as R,b as L,q as y}from"./queryClient-BMR_gP-p.js";import{g as O}from"./getCurrTicket-unHkMUTY.js";import{g as T}from"./getUser-DJBpJkua.js";const G="_falling_letters_container_11klv_1",V="_img_open_box_11klv_21",z="_logo_11klv_37",S={falling_letters_container:G,img_open_box:V,logo:z},P="/assets/S-white-DJHRycHD.png",A=({x:t,duration:n,id:a,onClick:c})=>e.jsxs("button",{className:"btn",onTouchStart:()=>c(a),id:a,style:{left:`${t}%`,animationDuration:`${n}s`},children:[" ",e.jsx("img",{src:P,className:"falling_letter_white"})]}),d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));function K(t,n=0){return(d[t[n+0]]+d[t[n+1]]+d[t[n+2]]+d[t[n+3]]+"-"+d[t[n+4]]+d[t[n+5]]+"-"+d[t[n+6]]+d[t[n+7]]+"-"+d[t[n+8]]+d[t[n+9]]+"-"+d[t[n+10]]+d[t[n+11]]+d[t[n+12]]+d[t[n+13]]+d[t[n+14]]+d[t[n+15]]).toLowerCase()}let N;const J=new Uint8Array(16);function Q(){if(!N){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");N=crypto.getRandomValues.bind(crypto)}return N(J)}const W=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:W};function _(t,n,a){if(I.randomUUID&&!n&&!t)return I.randomUUID();t=t||{};const c=t.random||(t.rng||Q)();return c[6]=c[6]&15|64,c[8]=c[8]&63|128,K(c)}const Z="_timer_container_1vdlq_1",X="_time_1vdlq_1",M={timer_container:Z,time:X},Y=t=>{const n=Math.floor(t%3600/60),a=t%60;return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};function tt({setIsVision:t,time:n,setTimer:a}){return m.useEffect(()=>{const c=setInterval(()=>{a(r=>r>0?r-1:(clearInterval(c),0))},1e3);return()=>clearInterval(c)},[a]),m.useEffect(()=>{n===0&&t(!1)},[n]),e.jsx("div",{className:M.timer_container,children:e.jsx("div",{className:M.time,children:Y(n)})})}const et="/assets/S-blue-Dh_q71fZ.png",nt=[{id:_(),duration:3,x:38},{id:_(),duration:1,x:58}],ot=({setCount:t,blueLetter:n,setBlueLetter:a})=>{const{tg:c}=v(),r=m.useRef([]),[l,g]=m.useState(0),u=o=>{a(i=>i.filter(s=>s.id!==o)),t(i=>i-3),c.HapticFeedback.impactOccurred("light")};return m.useEffect(()=>{const o=setInterval(()=>{if(l<5){const i=nt.map(s=>({...s,id:_(),duration:Math.random()+2}));a(s=>[...s,...i]),g(s=>s+1)}},2e3);return()=>clearInterval(o)},[l]),m.useEffect(()=>{const i=setInterval(()=>{r.current.forEach(s=>{s&&s.getBoundingClientRect().bottom>=window.innerHeight&&(t(f=>f+3),a(f=>f.filter(k=>k.id!==s.id)))})},10);return()=>clearInterval(i)},[n,t,a]),e.jsx(e.Fragment,{children:n.map((o,i)=>e.jsxs("button",{className:"btn_blue",onTouchStart:()=>u(o.id),id:o.id,ref:s=>r.current[i]=s,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",e.jsx("img",{className:"falling_letter_blue",src:et})]},o.id))})},at="_counter_container_47eta_1",st="_counter_47eta_1",C={counter_container:at,counter:st};function ct({count:t}){return e.jsx("div",{className:C.counter_container,children:e.jsx("div",{className:C.counter,children:t})})}const it="/assets/bomb-DeoDqckm.png";function $(){return Math.floor(Math.random()*81)+10}function rt({setCount:t,setWhiteLetter:n,setBlueLetter:a,setFlask:c}){const[r,l]=m.useState([]),{tg:g}=v(),u=o=>{l(i=>i.filter(s=>s.id!==o)),n([]),a([]),c([]),t(i=>i-10),g.HapticFeedback.impactOccurred("heavy")};return m.useEffect(()=>{const i=setInterval(()=>{const s={x:$(),duration:Math.random()+2,id:_().toString()};l(h=>[...h,s])},4e3);return()=>clearInterval(i)},[]),e.jsx(e.Fragment,{children:r.map(o=>e.jsxs("button",{className:"btn_bomb",onTouchStart:()=>u(o.id),id:o.id,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",e.jsx("img",{src:it,className:"falling_bomb"})]},o.id))})}const lt="/assets/flask-0VLBKfJP.png";function ut({setCount:t,flasks:n,setFlask:a}){const{tg:c}=v(),r=u=>{a(o=>o.filter(i=>i.id!==u)),t(o=>o+5),c.HapticFeedback.impactOccurred("light")},[l,g]=m.useState(0);return m.useEffect(()=>{const o=setInterval(()=>{if(l<3){const i={x:$(),duration:Math.random()+2,id:_().toString()};a(s=>[...s,i]),g(s=>s+1)}},4200);return()=>clearInterval(o)},[l]),e.jsx(e.Fragment,{children:n.map(u=>e.jsxs("button",{className:"btn_flask",onTouchStart:()=>r(u.id),id:u.id,style:{left:`${u.x}%`,animationDuration:`${u.duration}s`},children:[" ",e.jsx("img",{src:lt,className:"falling_flask"})]},u.id))})}const dt=[{id:_(),duration:Math.random()*3+2,x:5},{id:_(),duration:Math.random()*3+2,x:25},{id:_(),duration:Math.random()*3+2,x:45},{id:_(),duration:Math.random()*3+2,x:65},{id:_(),duration:Math.random()*3+2,x:82}],mt="_modal_vdn92_1",_t="_overlay_vdn92_17",gt="_content_vdn92_23",w={modal:mt,overlay:_t,content:gt};function xt({children:t}){return e.jsx("div",{className:w.modal,children:e.jsx("div",{className:w.overlay,children:e.jsx("div",{className:w.content,children:t})})})}const ht="_container_1dk7q_1",pt="_container_content_1dk7q_19",ft="_title_game_prize_1dk7q_47",bt="_coin_box_1dk7q_67",vt="_text_coin_1dk7q_83",kt="_new_game_button_1dk7q_107",jt="_back_home_button_1dk7q_143",p={container:ht,container_content:pt,title_game_prize:ft,coin_box:bt,text_coin:vt,new_game_button:kt,back_home_button:jt};function yt({tg_id:t,points:n,tickets:a,premium_tickets:c}){return R.post(`${L}/api/game-result/`,{points:n,tg_id:t,tickets:a,premium_tickets:c}).then(r=>r.data).catch(r=>{console.log(r)})}function St({finalPoints:t}){const n=D(),{tg:a,tg_id:c}=v(),r=F(O),l=F(T),g={tg_id:c,points:t,tickets:1},u={tg_id:c,points:t*2,premium_tickets:1},o=B({mutationFn:h=>yt(h)},y);console.log(r);const i=()=>{a.HapticFeedback.impactOccurred("light"),r?o.mutate(g,{onSuccess:()=>{(l==null?void 0:l.tickets)!==0&&location.reload()}}):o.mutate(u,{onSuccess:()=>{(l==null?void 0:l.premium_tickets)!==0&&location.reload()}})},s=()=>{a.HapticFeedback.impactOccurred("light"),r?o.mutate(g,{onSuccess:()=>{y.invalidateQueries({queryKey:["user"]}),n("/")}}):o.mutate(u,{onSuccess:()=>{y.invalidateQueries({queryKey:["user"]}),n("/")}})};return e.jsx("div",{className:p.container,children:e.jsxs("div",{className:p.container_content,children:[e.jsx("p",{className:p.title_game_prize,children:"Твоя награда:"}),e.jsxs("div",{className:p.coin_box,children:[e.jsx(U,{}),e.jsx("span",{className:p.text_coin,style:r?{background:"none"}:{background:"#3D3BFF"},children:r?t:t*2})]}),e.jsx("button",{onClick:i,className:p.new_game_button,children:"Новая игра"}),e.jsx("button",{onClick:s,className:p.back_home_button,children:"На главный экран"})]})})}function Dt(){const[t,n]=m.useState(!0),[a,c]=m.useState(15),[r,l]=m.useState(0),[g,u]=m.useState([]),[o,i]=m.useState([]),[s,h]=m.useState([]),{tg:f}=v();m.useEffect(()=>{const x=setInterval(()=>{u(b=>{const j=dt.map(q=>({...q,id:_(),duration:Math.random()+1.8}));return[...b,...j]})},800);return()=>clearInterval(x)},[]);const k=x=>{u(b=>b.filter(j=>j.id!==x)),l(b=>b+1),f.HapticFeedback.impactOccurred("light")};return e.jsx(xt,{children:e.jsxs("div",{className:S.falling_letters_container,children:[e.jsx(tt,{time:a,setTimer:c,setIsVision:n}),e.jsx("img",{width:69,height:15,src:H,className:S.logo}),e.jsx(ct,{count:r}),e.jsx("img",{src:E,className:S.img_open_box}),t?e.jsxs(e.Fragment,{children:[g.map(x=>e.jsx(A,{onClick:()=>k(x.id),id:x.id,x:x.x,duration:x.duration},x.id)),e.jsx(ot,{setCount:l,blueLetter:o,setBlueLetter:i}),e.jsx(ut,{setCount:c,flasks:s,setFlask:h}),e.jsx(rt,{setCount:l,setWhiteLetter:u,setBlueLetter:i,setFlask:h})]}):e.jsx(St,{finalPoints:r})]})})}export{Dt as default};
