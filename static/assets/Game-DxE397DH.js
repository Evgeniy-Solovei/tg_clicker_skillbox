import{j as e,r as d,u as v,f as $,e as D}from"./index-vYAf0OhG.js";import{i as E}from"./skillbox__box-DbP8mP4Q.js";import{l as H}from"./logo-exXQDy5k.js";import{H as B}from"./HeaderCoinSvg-BG7rBA1T.js";import{u as U}from"./useMutation-BTizHB9_.js";import{a as R,b as L,q as y}from"./queryClient-B1gO_aoP.js";import{g as O}from"./getCurrTicket-unHkMUTY.js";const T="_falling_letters_container_11klv_1",G="_img_open_box_11klv_21",V="_logo_11klv_37",S={falling_letters_container:T,img_open_box:G,logo:V},z="/assets/S-white-DJHRycHD.png",P=({x:t,duration:n,id:a,onClick:c})=>e.jsxs("button",{className:"btn",onTouchStart:()=>c(a),id:a,style:{left:`${t}%`,animationDuration:`${n}s`},children:[" ",e.jsx("img",{src:z,className:"falling_letter_white"})]}),u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));function A(t,n=0){return(u[t[n+0]]+u[t[n+1]]+u[t[n+2]]+u[t[n+3]]+"-"+u[t[n+4]]+u[t[n+5]]+"-"+u[t[n+6]]+u[t[n+7]]+"-"+u[t[n+8]]+u[t[n+9]]+"-"+u[t[n+10]]+u[t[n+11]]+u[t[n+12]]+u[t[n+13]]+u[t[n+14]]+u[t[n+15]]).toLowerCase()}let N;const K=new Uint8Array(16);function J(){if(!N){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");N=crypto.getRandomValues.bind(crypto)}return N(K)}const Q=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:Q};function _(t,n,a){if(F.randomUUID&&!n&&!t)return F.randomUUID();t=t||{};const c=t.random||(t.rng||J)();return c[6]=c[6]&15|64,c[8]=c[8]&63|128,A(c)}const W="_timer_container_1vdlq_1",Z="_time_1vdlq_1",I={timer_container:W,time:Z},X=t=>{const n=Math.floor(t%3600/60),a=t%60;return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};function Y({setIsVision:t,time:n,setTimer:a}){return d.useEffect(()=>{const c=setInterval(()=>{a(i=>i>0?i-1:(clearInterval(c),0))},1e3);return()=>clearInterval(c)},[a]),d.useEffect(()=>{n===0&&t(!1)},[n]),e.jsx("div",{className:I.timer_container,children:e.jsx("div",{className:I.time,children:X(n)})})}const tt="/assets/S-blue-Dh_q71fZ.png",et=[{id:_(),duration:3,x:38},{id:_(),duration:1,x:58}],nt=({setCount:t,blueLetter:n,setBlueLetter:a})=>{const{tg:c}=v(),i=d.useRef([]),[m,g]=d.useState(0),l=o=>{a(r=>r.filter(s=>s.id!==o)),t(r=>r-3),c.HapticFeedback.impactOccurred("light")};return d.useEffect(()=>{const o=setInterval(()=>{if(m<5){const r=et.map(s=>({...s,id:_(),duration:Math.random()+2}));a(s=>[...s,...r]),g(s=>s+1)}},2e3);return()=>clearInterval(o)},[m]),d.useEffect(()=>{const r=setInterval(()=>{i.current.forEach(s=>{s&&s.getBoundingClientRect().bottom>=window.innerHeight&&(t(b=>b+3),a(b=>b.filter(k=>k.id!==s.id)))})},10);return()=>clearInterval(r)},[n,t,a]),e.jsx(e.Fragment,{children:n.map((o,r)=>e.jsxs("button",{className:"btn_blue",onTouchStart:()=>l(o.id),id:o.id,ref:s=>i.current[r]=s,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",e.jsx("img",{className:"falling_letter_blue",src:tt})]},o.id))})},ot="_counter_container_47eta_1",at="_counter_47eta_1",q={counter_container:ot,counter:at};function st({count:t}){return e.jsx("div",{className:q.counter_container,children:e.jsx("div",{className:q.counter,children:t})})}const ct="/assets/bomb-DeoDqckm.png";function M(){return Math.floor(Math.random()*81)+10}function rt({setCount:t,setWhiteLetter:n,setBlueLetter:a,setFlask:c}){const[i,m]=d.useState([]),{tg:g}=v(),l=o=>{m(r=>r.filter(s=>s.id!==o)),n([]),a([]),c([]),t(r=>r-10),g.HapticFeedback.impactOccurred("heavy")};return d.useEffect(()=>{const r=setInterval(()=>{const s={x:M(),duration:Math.random()+2,id:_().toString()};m(p=>[...p,s])},4e3);return()=>clearInterval(r)},[]),e.jsx(e.Fragment,{children:i.map(o=>e.jsxs("button",{className:"btn_bomb",onTouchStart:()=>l(o.id),id:o.id,style:{left:`${o.x}%`,animationDuration:`${o.duration}s`},children:[" ",e.jsx("img",{src:ct,className:"falling_bomb"})]},o.id))})}const it="/assets/flask-0VLBKfJP.png";function lt({setCount:t,flasks:n,setFlask:a}){const{tg:c}=v(),i=l=>{a(o=>o.filter(r=>r.id!==l)),t(o=>o+5),c.HapticFeedback.impactOccurred("light")},[m,g]=d.useState(0);return d.useEffect(()=>{const o=setInterval(()=>{if(m<3){const r={x:M(),duration:Math.random()+2,id:_().toString()};a(s=>[...s,r]),g(s=>s+1)}},4200);return()=>clearInterval(o)},[m]),e.jsx(e.Fragment,{children:n.map(l=>e.jsxs("button",{className:"btn_flask",onTouchStart:()=>i(l.id),id:l.id,style:{left:`${l.x}%`,animationDuration:`${l.duration}s`},children:[" ",e.jsx("img",{src:it,className:"falling_flask"})]},l.id))})}const ut=[{id:_(),duration:Math.random()*3+2,x:5},{id:_(),duration:Math.random()*3+2,x:25},{id:_(),duration:Math.random()*3+2,x:45},{id:_(),duration:Math.random()*3+2,x:65},{id:_(),duration:Math.random()*3+2,x:82}],dt="_modal_rq50g_1",mt="_overlay_rq50g_16",_t="_content_rq50g_22",w={modal:dt,overlay:mt,content:_t};function gt({children:t}){return e.jsx("div",{className:w.modal,children:e.jsx("div",{className:w.overlay,children:e.jsx("div",{className:w.content,children:t})})})}const xt="_container_1dk7q_1",ht="_container_content_1dk7q_19",pt="_title_game_prize_1dk7q_47",bt="_coin_box_1dk7q_67",ft="_text_coin_1dk7q_83",vt="_new_game_button_1dk7q_107",kt="_back_home_button_1dk7q_143",h={container:xt,container_content:ht,title_game_prize:pt,coin_box:bt,text_coin:ft,new_game_button:vt,back_home_button:kt};function jt({tg_id:t,points:n,tickets:a,premium_tickets:c}){return R.post(`${L}/api/game-result/`,{points:n,tg_id:t,tickets:a,premium_tickets:c}).then(i=>i.data).catch(i=>{console.log(i)})}function yt({finalPoints:t}){const n=$(),{tg:a,tg_id:c}=v(),i=D(O),m={tg_id:c,points:t,tickets:1},g={tg_id:c,points:t*2,premium_tickets:1},l=U({mutationFn:s=>jt(s)},y);console.log(i);const o=()=>{a.HapticFeedback.impactOccurred("light"),i?l.mutate(m,{onSuccess:()=>{location.reload()}}):l.mutate(g,{onSuccess:()=>{location.reload()}})},r=()=>{a.HapticFeedback.impactOccurred("light"),i?l.mutate(m,{onSuccess:()=>{y.invalidateQueries({queryKey:["user"]}),n("/")}}):l.mutate(g,{onSuccess:()=>{y.invalidateQueries({queryKey:["user"]}),n("/")}})};return e.jsx("div",{className:h.container,children:e.jsxs("div",{className:h.container_content,children:[e.jsx("p",{className:h.title_game_prize,children:"Твоя награда:"}),e.jsxs("div",{className:h.coin_box,children:[e.jsx(B,{}),e.jsx("span",{className:h.text_coin,style:i?{background:"none"}:{background:"#3D3BFF"},children:i?t:t*2})]}),e.jsx("button",{onClick:o,className:h.new_game_button,children:"Новая игра"}),e.jsx("button",{onClick:r,className:h.back_home_button,children:"На главный экран"})]})})}function Ct(){const[t,n]=d.useState(!0),[a,c]=d.useState(15),[i,m]=d.useState(0),[g,l]=d.useState([]),[o,r]=d.useState([]),[s,p]=d.useState([]),{tg:b}=v();d.useEffect(()=>{const x=setInterval(()=>{l(f=>{const j=ut.map(C=>({...C,id:_(),duration:Math.random()+1.8}));return[...f,...j]})},800);return()=>clearInterval(x)},[]);const k=x=>{l(f=>f.filter(j=>j.id!==x)),m(f=>f+1),b.HapticFeedback.impactOccurred("light")};return e.jsx(gt,{children:e.jsxs("div",{className:S.falling_letters_container,children:[e.jsx(Y,{time:a,setTimer:c,setIsVision:n}),e.jsx("img",{width:69,height:15,src:H,className:S.logo}),e.jsx(st,{count:i}),e.jsx("img",{src:E,className:S.img_open_box}),t?e.jsxs(e.Fragment,{children:[g.map(x=>e.jsx(P,{onClick:()=>k(x.id),id:x.id,x:x.x,duration:x.duration},x.id)),e.jsx(nt,{setCount:m,blueLetter:o,setBlueLetter:r}),e.jsx(lt,{setCount:c,flasks:s,setFlask:p}),e.jsx(rt,{setCount:m,setWhiteLetter:l,setBlueLetter:r,setFlask:p})]}):e.jsx(yt,{finalPoints:i})]})})}export{Ct as default};
