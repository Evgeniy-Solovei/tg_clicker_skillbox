import{u as x,j as i,r as o}from"./index-BG6DyFqA.js";import{a as N,P as y}from"./PageUI-BWAI3MgG.js";import{u as j}from"./useQuery-D34snuXy.js";import{b as q,c as F,f as S}from"./fetchFriends-y7U9GO30.js";import{q as g}from"./queryClient-BaKBWkNZ.js";import{u as C}from"./useMutation-B7d0R4Ug.js";import{i as D}from"./coin-DlK3Y3AM.js";import{S as H}from"./SlidingPanel-B1TXrPRi.js";import{f as L}from"./friends__invite-Ds21nNo3.js";import{H as $}from"./HeaderCoinSvg-CJL83Nx2.js";const w="_friends__section_1kllm_1",E="_friends__title_1kllm_6",O="_friends__invite_1kllm_10",R="_invite__title_1kllm_23",T="_invite__label_1kllm_31",I="_invite__button_1kllm_39",P="_page__list_1kllm_50",a={friends__section:w,friends__title:E,friends__invite:O,invite__title:R,invite__label:T,invite__button:I,page__list:P},U="_friends__item_3q1nm_1",A="_friends__position_3q1nm_19",K="_friends__avatar_3q1nm_33",M="_friends__info_3q1nm_45",Q="_friends__name_3q1nm_57",z="_friends__coins_3q1nm_69",B="_icon_coin_3q1nm_81",Y="_friends__button_3q1nm_93",G="_friends_reg_data_3q1nm_121",n={friends__item:U,friends__position:A,friends__avatar:K,friends__info:M,friends__name:Q,friends__coins:z,icon_coin:B,friends__button:Y,friends_reg_data:G};function J(e){const s=new Date(e),t=String(s.getUTCDate()).padStart(2,"0"),_=String(s.getUTCMonth()+1).padStart(2,"0"),l=String(s.getUTCFullYear()).slice(-2);return`${t}.${_}.${l}`}function f({friends:e,index:s,isOpen:t,isDisabled:_}){const{tg:l,tg_id:u}=x(),p=C({mutationFn:r=>q(r.tg_id,r.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&t(!0)},onError:r=>{console.log(r)}},g),c=()=>{p.mutate({tg_id:u,new_player_id:e.tg_id}),l.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:n.friends__item,children:[i.jsx("span",{className:n.friends__position,children:s+1}),i.jsx("img",{className:n.friends__avatar,src:N,alt:"avatar"}),i.jsxs("div",{className:n.friends__info,children:[i.jsx("p",{className:n.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:n.icon_coin,children:[i.jsx("img",{width:12,height:12,className:n.iconCoin,src:D,alt:""}),i.jsx("p",{className:n.friends__coins,children:e==null?void 0:e.points})]})]}),e.referral_bonus?i.jsx("button",{disabled:_,onClick:c,className:n.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:n.friends_reg_data,children:["Приглашён ",J(e.reg_data)]})]})}const V="_sliding__button_j3igf_1",W="_sliding__block_j3igf_9",X="_sliding__image_j3igf_21",Z="_sliding__title_j3igf_25",ii="_sliding__label_j3igf_33",d={sliding__button:V,sliding__block:W,sliding__image:X,sliding__title:Z,sliding__label:ii},ei=({isOpen:e,onClose:s,fullHeight:t,initialHeight:_})=>i.jsx(H,{initialHeight:_,fullHeight:t,darkened:!0,isOpen:e,onClose:s,children:i.jsxs("div",{className:d.sliding__block,children:[i.jsx("img",{className:d.sliding__image,width:215,height:215,src:L,alt:""}),i.jsx("h2",{className:d.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:d.sliding__label,children:[i.jsx($,{}),i.jsx("span",{children:"500"})]}),i.jsx("button",{onClick:s,className:d.sliding__button,children:"Ура!"})]})});function mi(){const{tg:e,tg_id:s}=x(),[t,_]=o.useState([]),[l,u]=o.useState(""),[p,c]=o.useState(!1),r=()=>{c(!1)},v=()=>{const m=`https://t.me/share/url?url=${l}`;e.openTelegramLink(m),e.HapticFeedback.impactOccurred("light")},h=j({queryKey:["refLink"],queryFn:()=>F(s)},g),{data:b}=j({queryKey:["friends"],queryFn:()=>S(s)},g);return o.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),o.useEffect(()=>{b&&_(b)},[b]),i.jsxs(i.Fragment,{children:[i.jsxs(y,{className:a.friends__section,className__title:a.friends__title,title:"Друзья",children:[i.jsxs("div",{className:a.friends__invite,children:[i.jsx("h2",{className:a.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:a.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:a.invite__button,onClick:v,children:"Пригласить друга"})]}),i.jsxs("ul",{className:a.page__list,children:[t.map((m,k)=>i.jsx(f,{isOpen:c,friends:m,index:k,isDisabled:!1},m.tg_id)),t.length===0&&i.jsxs(i.Fragment,{children:[i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),i.jsx(ei,{isOpen:p,onClose:r,initialHeight:"70%",fullHeight:"70vh"})]})}export{mi as default};
