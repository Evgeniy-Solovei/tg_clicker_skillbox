import{u as p,j as e,r as d}from"./index-CFy4tlWf.js";import{a as h,P as x}from"./PageUI-C8-qxOvC.js";import{u as g}from"./useQuery-CCF_MlAD.js";import{b as j,c as b,f as k}from"./fetchFriends-Dilnl0x7.js";import{q as l}from"./queryClient-BzWzcDsO.js";import{u as q}from"./useMutation-Dm14ll5S.js";import{H as y}from"./HeaderCoinSvg-DWTRQDPx.js";const N="_friends__section_9k5ar_1",F="_friends__title_9k5ar_6",S="_friends__invite_9k5ar_10",C="_invite__title_9k5ar_23",L="_invite__label_9k5ar_31",E="_invite__button_9k5ar_39",R="_page__list_9k5ar_50",_={friends__section:N,friends__title:F,friends__invite:S,invite__title:C,invite__label:L,invite__button:E,page__list:R},T="_friends__item_3q1nm_1",$="_friends__position_3q1nm_19",w="_friends__avatar_3q1nm_33",H="_friends__info_3q1nm_45",U="_friends__name_3q1nm_57",A="_friends__coins_3q1nm_69",D="_icon_coin_3q1nm_81",K="_friends__button_3q1nm_93",O="_friends_reg_data_3q1nm_121",n={friends__item:T,friends__position:$,friends__avatar:w,friends__info:H,friends__name:U,friends__coins:A,icon_coin:D,friends__button:K,friends_reg_data:O};function P(t){const i=new Date(t),r=String(i.getUTCDate()).padStart(2,"0"),a=String(i.getUTCMonth()+1).padStart(2,"0"),o=String(i.getUTCFullYear()).slice(-2);return`${r}.${a}.${o}`}function I({friends:t,index:i}){const{tg:r,tg_id:a}=p(),o=q({mutationFn:s=>j(s.tg_id,s.new_player_id),onSuccess:()=>{l.invalidateQueries({queryKey:["friends"]})},onError:s=>{console.log(s)}},l),f=()=>{o.mutate({tg_id:a,new_player_id:t.tg_id}),r.HapticFeedback.impactOccurred("light")};return e.jsxs("li",{className:n.friends__item,children:[e.jsx("span",{className:n.friends__position,children:i+1}),e.jsx("img",{className:n.friends__avatar,src:h,alt:"avatar"}),e.jsxs("div",{className:n.friends__info,children:[e.jsx("p",{className:n.friends__name,children:t==null?void 0:t.name}),e.jsxs("div",{className:n.icon_coin,children:[e.jsx(y,{width:"12",height:"12"}),e.jsx("p",{className:n.friends__coins,children:t==null?void 0:t.points})]})]}),t.referral_bonus?e.jsx("button",{onClick:f,className:n.friends__button,children:"Забрать награду"}):e.jsxs("span",{className:n.friends_reg_data,children:["Приглашён ",P(t.reg_data)]})]})}function V(){const{tg:t,tg_id:i}=p(),[r,a]=d.useState([]),[o,f]=d.useState(""),s=()=>{const c=`https://t.me/share/url?url=${o}`;t.openTelegramLink(c),t.HapticFeedback.impactOccurred("light")},m=g({queryKey:["refLink"],queryFn:()=>b(i)},l),{data:u}=g({queryKey:["friends"],queryFn:()=>k(i)},l);return d.useEffect(()=>{m.data&&f(m.data.ref_link)},[m]),d.useEffect(()=>{u&&a(u)},[u]),e.jsxs(x,{className:_.friends__section,className__title:_.friends__title,title:"Друзья",children:[e.jsxs("div",{className:_.friends__invite,children:[e.jsx("h2",{className:_.invite__title,children:"Играть вместе веселее!"}),e.jsx("p",{className:_.invite__label,children:"Получай награды за каждого друга, который присоединился"}),e.jsx("button",{className:_.invite__button,onClick:s,children:"Пригласить друга"})]}),e.jsx("ul",{className:_.page__list,children:r.map((c,v)=>e.jsx(I,{friends:c,index:v},c.tg_id))})]})}export{V as default};
