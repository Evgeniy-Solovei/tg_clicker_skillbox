import{u as j,j as i,r as o}from"./index-B9LwE138.js";import{a as N,P as q}from"./PageUI-Cs_Wz0Gd.js";import{i as y,u as x}from"./coin-DSwUmHEW.js";import{b as F,c as S,f as C}from"./fetchFriends-Do1QxVU6.js";import{q as g}from"./queryClient-CDAWTZkk.js";import{u as D}from"./useMutation-DYRPDdfj.js";import{S as H}from"./SlidingPanel-o3WmUNf9.js";import{f as L}from"./friends__invite-Ds21nNo3.js";import{H as $}from"./HeaderCoinSvg-xibK20fa.js";const w="_friends__section_1kllm_1",E="_friends__title_1kllm_6",O="_friends__invite_1kllm_10",R="_invite__title_1kllm_23",T="_invite__label_1kllm_31",I="_invite__button_1kllm_39",P="_page__list_1kllm_50",a={friends__section:w,friends__title:E,friends__invite:O,invite__title:R,invite__label:T,invite__button:I,page__list:P},U="_friends__item_3q1nm_1",A="_friends__position_3q1nm_19",K="_friends__avatar_3q1nm_33",M="_friends__info_3q1nm_45",Q="_friends__name_3q1nm_57",z="_friends__coins_3q1nm_69",B="_icon_coin_3q1nm_81",Y="_friends__button_3q1nm_93",G="_friends_reg_data_3q1nm_121",s={friends__item:U,friends__position:A,friends__avatar:K,friends__info:M,friends__name:Q,friends__coins:z,icon_coin:B,friends__button:Y,friends_reg_data:G};function J(e){const n=new Date(e),t=String(n.getUTCDate()).padStart(2,"0"),_=String(n.getUTCMonth()+1).padStart(2,"0"),c=String(n.getUTCFullYear()).slice(-2);return`${t}.${_}.${c}`}function f({friends:e,index:n,isOpen:t,isDisabled:_}){const{tg:c,tg_id:u}=j(),p=D({mutationFn:r=>F(r.tg_id,r.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&t(!0)},onError:r=>{console.log(r)}},g),d=()=>{p.mutate({tg_id:u,new_player_id:e.tg_id}),c.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:s.friends__item,children:[i.jsx("span",{className:s.friends__position,children:n+1}),i.jsx("img",{className:s.friends__avatar,src:N,alt:"avatar"}),i.jsxs("div",{className:s.friends__info,children:[i.jsx("p",{className:s.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:s.icon_coin,children:[i.jsx("img",{width:12,height:12,className:s.iconCoin,src:y,alt:""}),i.jsx("p",{className:s.friends__coins,children:e==null?void 0:e.points})]})]}),e.referral_bonus?i.jsx("button",{disabled:_,onClick:d,className:s.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:s.friends_reg_data,children:["Приглашён ",J(e.reg_data)]})]})}const V="_sliding__button_1drcq_1",W="_sliding__block_1drcq_15",X="_sliding__image_1drcq_28",Z="_sliding__title_1drcq_32",ii="_sliding__label_1drcq_40",ei="_count_coin_1drcq_51",l={sliding__button:V,sliding__block:W,sliding__image:X,sliding__title:Z,sliding__label:ii,count_coin:ei},ni=({isOpen:e,onClose:n,fullHeight:t,initialHeight:_})=>i.jsx(H,{initialHeight:_,fullHeight:t,darkened:!0,isOpen:e,onClose:n,children:i.jsxs("div",{className:l.sliding__block,children:[i.jsx("img",{className:l.sliding__image,width:215,height:215,src:L,alt:""}),i.jsx("h2",{className:l.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:l.sliding__label,children:[i.jsx($,{}),i.jsx("span",{className:l.count_coin,children:"500"})]}),i.jsx("button",{onClick:n,className:l.sliding__button,children:"Ура!"})]})});function mi(){const{tg:e,tg_id:n}=j(),[t,_]=o.useState([]),[c,u]=o.useState(""),[p,d]=o.useState(!1),r=()=>{d(!1)},v=()=>{const m=`https://t.me/share/url?url=${c}`;e.openTelegramLink(m),e.HapticFeedback.impactOccurred("light")},h=x({queryKey:["refLink"],queryFn:()=>S(n)},g),{data:b}=x({queryKey:["friends"],queryFn:()=>C(n)},g);return o.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),o.useEffect(()=>{b&&_(b)},[b]),i.jsxs(i.Fragment,{children:[i.jsxs(q,{className:a.friends__section,className__title:a.friends__title,title:"Друзья",children:[i.jsxs("div",{className:a.friends__invite,children:[i.jsx("h2",{className:a.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:a.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:a.invite__button,onClick:v,children:"Пригласить друга"})]}),i.jsxs("ul",{className:a.page__list,children:[t.map((m,k)=>i.jsx(f,{isOpen:d,friends:m,index:k,isDisabled:!1},m.tg_id)),t.length===0&&i.jsxs(i.Fragment,{children:[i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),i.jsx(ni,{isOpen:p,onClose:r,initialHeight:"70%",fullHeight:"70vh"})]})}export{mi as default};
