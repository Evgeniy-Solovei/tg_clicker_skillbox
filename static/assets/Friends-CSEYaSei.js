import{u as x,j as i,r as c}from"./index-DPZHz7Nu.js";import{a as v,P as N}from"./avatar-CWS-1CxM.js";import{b as y,u as F,f as q,c as S}from"./fetchFriends-BLpPzvrK.js";import{u as C}from"./useSuspenseQuery-BmzOoTKu.js";import{q as g}from"./queryClient-FfStCLF0.js";import{u as H}from"./useMutation-DXgfAszU.js";import{i as O}from"./coin-DGDLXMHh.js";import{f as D}from"./formatNumber-B2gvpCqi.js";import{S as L}from"./SlidingPanel-ClboMQGW.js";import{f as $}from"./friends__invite-Ds21nNo3.js";import{H as w}from"./HeaderCoinSvg-BleC6Qe1.js";const R="_friends__section_1kllm_1",T="_friends__title_1kllm_6",E="_friends__invite_1kllm_10",I="_invite__title_1kllm_23",P="_invite__label_1kllm_31",U="_invite__button_1kllm_39",A="_page__list_1kllm_50",r={friends__section:R,friends__title:T,friends__invite:E,invite__title:I,invite__label:P,invite__button:U,page__list:A},K="_friends__item_3q1nm_1",Q="_friends__position_3q1nm_19",M="_friends__avatar_3q1nm_33",z="_friends__info_3q1nm_45",B="_friends__name_3q1nm_57",Y="_friends__coins_3q1nm_69",G="_icon_coin_3q1nm_81",J="_friends__button_3q1nm_93",V="_friends_reg_data_3q1nm_121",n={friends__item:K,friends__position:Q,friends__avatar:M,friends__info:z,friends__name:B,friends__coins:Y,icon_coin:G,friends__button:J,friends_reg_data:V};function W(e){const s=new Date(e),t=String(s.getUTCDate()).padStart(2,"0"),a=String(s.getUTCMonth()+1).padStart(2,"0"),_=String(s.getUTCFullYear()).slice(-2);return`${t}.${a}.${_}`}function f({friends:e,index:s,isOpen:t,isDisabled:a}){const{tg:_,tg_id:u}=x(),p=H({mutationFn:d=>y(d.tg_id,d.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&(t(!0),_.HapticFeedback.impactOccurred("light"))}},g),o=()=>{p.mutate({tg_id:u,new_player_id:e.tg_id}),_.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:n.friends__item,children:[i.jsx("span",{className:n.friends__position,children:s+1}),i.jsx("img",{className:n.friends__avatar,src:v,alt:"avatar"}),i.jsxs("div",{className:n.friends__info,children:[i.jsx("p",{className:n.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:n.icon_coin,children:[i.jsx("img",{width:12,height:12,className:n.iconCoin,src:O,alt:""}),i.jsx("p",{className:n.friends__coins,children:e&&D(+(e==null?void 0:e.points))})]})]}),e.referral_bonus?i.jsx("button",{disabled:a,onClick:o,className:n.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:n.friends_reg_data,children:["Приглашён ",W(e.reg_data)]})]})}const X="_sliding__button_1ialg_1",Z="_sliding__block_1ialg_15",ii="_sliding__image_1ialg_28",ei="_sliding__title_1ialg_32",si="_sliding__label_1ialg_40",ni="_count_coin_1ialg_51",l={sliding__button:X,sliding__block:Z,sliding__image:ii,sliding__title:ei,sliding__label:si,count_coin:ni},ti=({isOpen:e,onClose:s,fullHeight:t,initialHeight:a})=>{const{tg:_}=x();return i.jsx(L,{initialHeight:a,fullHeight:t,darkened:!0,isOpen:e,onClose:s,children:i.jsxs("div",{className:l.sliding__block,children:[i.jsx("img",{className:l.sliding__image,width:215,height:215,src:$,alt:""}),i.jsx("h2",{className:l.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:l.sliding__label,children:[i.jsx(w,{}),i.jsx("span",{className:l.count_coin,children:"500"})]}),i.jsx("button",{onClick:()=>{s(),_.HapticFeedback.impactOccurred("light")},className:l.sliding__button,children:"Ура!"})]})})};function pi(){const{tg:e,tg_id:s}=x(),[t,a]=c.useState([]),[_,u]=c.useState(""),[p,o]=c.useState(!1),d=()=>{o(!1),e.HapticFeedback.impactOccurred("light")},j=()=>{const m=`https://t.me/share/url?url=${_}`;e.openTelegramLink(m),e.HapticFeedback.impactOccurred("light")},h=F({queryKey:["refLink"],queryFn:()=>S(s)},g),{data:b}=C({queryKey:["friends"],queryFn:()=>q(s)},g);return c.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),c.useEffect(()=>{b&&a(b)},[b]),i.jsxs(i.Fragment,{children:[i.jsxs(N,{className:r.friends__section,className__title:r.friends__title,title:"Друзья",children:[i.jsxs("div",{className:r.friends__invite,children:[i.jsx("h2",{className:r.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:r.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:r.invite__button,onClick:j,children:"Пригласить друга"})]}),i.jsxs("ul",{className:r.page__list,children:[t.map((m,k)=>i.jsx(f,{isOpen:o,friends:m,index:k,isDisabled:!1},m.tg_id)),t.length===0&&i.jsxs(i.Fragment,{children:[i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),i.jsx(ti,{isOpen:p,onClose:d,initialHeight:"70%",fullHeight:"70vh"})]})}export{pi as default};
