import{u as x,j as i,r as c}from"./index-Bo-eR_JQ.js";import{a as N,P as y}from"./avatar-CIwZeDhn.js";import{i as F,u as j}from"./coin-BpkcyZK3.js";import{b as q,c as S,f as C}from"./fetchFriends-D8qq094O.js";import{q as g}from"./queryClient-DzN13fHD.js";import{u as H}from"./useMutation-CvrEcQzQ.js";import{S as O}from"./SlidingPanel-FiPemMas.js";import{f as D}from"./friends__invite-Ds21nNo3.js";import{H as L}from"./HeaderCoinSvg-BSC_LbVA.js";const $="_friends__section_1kllm_1",w="_friends__title_1kllm_6",R="_friends__invite_1kllm_10",T="_invite__title_1kllm_23",E="_invite__label_1kllm_31",I="_invite__button_1kllm_39",P="_page__list_1kllm_50",r={friends__section:$,friends__title:w,friends__invite:R,invite__title:T,invite__label:E,invite__button:I,page__list:P},U="_friends__item_3q1nm_1",A="_friends__position_3q1nm_19",K="_friends__avatar_3q1nm_33",M="_friends__info_3q1nm_45",Q="_friends__name_3q1nm_57",z="_friends__coins_3q1nm_69",B="_icon_coin_3q1nm_81",Y="_friends__button_3q1nm_93",G="_friends_reg_data_3q1nm_121",s={friends__item:U,friends__position:A,friends__avatar:K,friends__info:M,friends__name:Q,friends__coins:z,icon_coin:B,friends__button:Y,friends_reg_data:G};function J(e){const n=new Date(e),t=String(n.getUTCDate()).padStart(2,"0"),a=String(n.getUTCMonth()+1).padStart(2,"0"),_=String(n.getUTCFullYear()).slice(-2);return`${t}.${a}.${_}`}function f({friends:e,index:n,isOpen:t,isDisabled:a}){const{tg:_,tg_id:u}=x(),p=H({mutationFn:d=>q(d.tg_id,d.new_player_id),onSuccess:()=>{g.invalidateQueries({queryKey:["friends"]}),t&&(t(!0),_.HapticFeedback.impactOccurred("light"))}},g),o=()=>{p.mutate({tg_id:u,new_player_id:e.tg_id}),_.HapticFeedback.impactOccurred("light")};return i.jsxs("li",{className:s.friends__item,children:[i.jsx("span",{className:s.friends__position,children:n+1}),i.jsx("img",{className:s.friends__avatar,src:N,alt:"avatar"}),i.jsxs("div",{className:s.friends__info,children:[i.jsx("p",{className:s.friends__name,children:e==null?void 0:e.name}),i.jsxs("div",{className:s.icon_coin,children:[i.jsx("img",{width:12,height:12,className:s.iconCoin,src:F,alt:""}),i.jsx("p",{className:s.friends__coins,children:e==null?void 0:e.points})]})]}),e.referral_bonus?i.jsx("button",{disabled:a,onClick:o,className:s.friends__button,children:"Забрать награду"}):i.jsxs("span",{className:s.friends_reg_data,children:["Приглашён ",J(e.reg_data)]})]})}const V="_sliding__button_1ialg_1",W="_sliding__block_1ialg_15",X="_sliding__image_1ialg_28",Z="_sliding__title_1ialg_32",ii="_sliding__label_1ialg_40",ei="_count_coin_1ialg_51",l={sliding__button:V,sliding__block:W,sliding__image:X,sliding__title:Z,sliding__label:ii,count_coin:ei},ni=({isOpen:e,onClose:n,fullHeight:t,initialHeight:a})=>{const{tg:_}=x();return i.jsx(O,{initialHeight:a,fullHeight:t,darkened:!0,isOpen:e,onClose:n,children:i.jsxs("div",{className:l.sliding__block,children:[i.jsx("img",{className:l.sliding__image,width:215,height:215,src:D,alt:""}),i.jsx("h2",{className:l.sliding__title,children:"Твоя награда:"}),i.jsxs("p",{className:l.sliding__label,children:[i.jsx(L,{}),i.jsx("span",{className:l.count_coin,children:"500"})]}),i.jsx("button",{onClick:()=>{n(),_.HapticFeedback.impactOccurred("light")},className:l.sliding__button,children:"Ура!"})]})})};function mi(){const{tg:e,tg_id:n}=x(),[t,a]=c.useState([]),[_,u]=c.useState(""),[p,o]=c.useState(!1),d=()=>{o(!1),e.HapticFeedback.impactOccurred("light")},k=()=>{const m=`https://t.me/share/url?url=${_}`;e.openTelegramLink(m),e.HapticFeedback.impactOccurred("light")},h=j({queryKey:["refLink"],queryFn:()=>S(n)},g),{data:b}=j({queryKey:["friends"],queryFn:()=>C(n)},g);return c.useEffect(()=>{h.data&&u(h.data.ref_link)},[h]),c.useEffect(()=>{b&&a(b)},[b]),i.jsxs(i.Fragment,{children:[i.jsxs(y,{className:r.friends__section,className__title:r.friends__title,title:"Друзья",children:[i.jsxs("div",{className:r.friends__invite,children:[i.jsx("h2",{className:r.invite__title,children:"Играть вместе веселее!"}),i.jsx("p",{className:r.invite__label,children:"Получай награды за каждого друга, который присоединился"}),i.jsx("button",{className:r.invite__button,onClick:k,children:"Пригласить друга"})]}),i.jsxs("ul",{className:r.page__list,children:[t.map((m,v)=>i.jsx(f,{isOpen:o,friends:m,index:v,isDisabled:!1},m.tg_id)),t.length===0&&i.jsxs(i.Fragment,{children:[i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!0,tg_id:"654651"},isDisabled:!0,index:0})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:1})," ",i.jsx(f,{friends:{name:"Name",points:"1.2kk",reg_data:"10.10.24",referral_bonus:!1,tg_id:"654651"},isDisabled:!0,index:2})]})]})]}),i.jsx(ni,{isOpen:p,onClose:d,initialHeight:"70%",fullHeight:"70vh"})]})}export{mi as default};
